import{_ as re,u as le,r as _,a as se,y,o as ie,b as f,v as ce,d as b,e as c,g as a,w as s,h,i as S,x as ue,k as o,f as i,t as p,R as me,m as M,I as u,n as N,F as V,S as de,E as A}from"./index-JqcLm-KS.js";const pe={class:"widget-header"},ge={class:"header-actions"},fe={class:"device-cell"},_e={class:"vendor-cell"},he={class:"capacity-cell"},Se={key:1,class:"temp-cell temp-unknown"},be={key:1,class:"error-message"},ve={name:"StorageSmartDevices",displayName:"Monitorowane urządzenia"},we=Object.assign(ve,{setup(ye){const{t:l}=le(),k=_([]),v=_(!1),w=_(null),B=_(!1),L=_(""),C=_(!1),R=_(""),U=se();y.defaults.baseURL=`${window.location.protocol}//${window.location.hostname}:3000`;const j=e=>e.startsWith("nvme")?"mdi:memory":(e.startsWith("sd"),"mdi:harddisk"),F=e=>{R.value=JSON.stringify(e.rawData,null,2),C.value=!0},$=e=>({Samsung:"simple-icons:samsung","Western Digital":"simple-icons:westerndigital",Seagate:"simple-icons:seagate",Toshiba:"simple-icons:toshiba",Intel:"simple-icons:intel"})[e]||null,W=(e,t=2)=>{if(isNaN(e))return l("common.na");if(e===0)return"0 Bytes";const r=1024,m=["Bytes","KB","MB","GB","TB"],d=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,d)).toFixed(t))+" "+m[d]},H=e=>e==null?"temp-unknown":e>60?"temp-high":e>50?"temp-warning":"temp-normal",Z=e=>e.badSectors>0?l("storageSmart.statusValues.badSectors"):l(`storageSmart.statusValues.${e.status}`),G=e=>{if(e.badSectors>0)return"warning";switch(e.status){case"healthy":return"success";case"warning":return"warning";case"error":return"danger";default:return"info"}},J=e=>{U.push(`/storage/smart/devices/details/${encodeURIComponent(e)}`)},K=()=>{navigator.clipboard.writeText(l("storageSmart.installCommand")),ElMessage.success(l("storageSmart.commandCopied"))},q=e=>e.badSectors>0||e.outOfSpecParams&&e.outOfSpecParams.length>0||z(e.temperature,e.isSSD),Q=e=>{const t=[];if(e.badSectors>0&&t.push(`Bad sectors: ${e.badSectors}`),e.outOfSpecParams&&e.outOfSpecParams.length>0&&t.push(`Out of spec parameters: ${e.outOfSpecParams.length}`),z(e.temperature,e.isSSD)){const r=e.isSSD?O:P;t.push(`High temperature: ${e.temperature}°C (max ${r}°C)`)}return t.join(`
`)},z=(e,t=!1)=>e?e>(t?O:P):!1,O=50,P=55,x=async()=>{try{v.value=!0,w.value=null;const[e,t]=await Promise.all([y.get("/api/storage/smart"),y.get("/api/storage/smart/monitoring")]);k.value=e.data.data.map(r=>{const m=t.data.devices[r.device]?.monitored||!1,d=Y(r.rawData),D=ee(r.rawData),I=r.rawData?.rotation_rate===0;return{...r,monitored:m,loading:!1,badSectors:d,outOfSpecParams:D,isSSD:I,temperature:te(r.rawData)||r.temperature}})}catch(e){if(w.value=l("storageSmart.errorLoading"),console.error("Error fetching devices:",e),e.response?.config?.url.includes("monitoring"))try{const t=await y.get("/api/storage/smart");k.value=t.data.data.map(r=>({...r,monitored:!1,loading:!1}))}catch(t){console.error("Error fetching SMART data:",t)}}finally{v.value=!1}},X=async e=>{const t=e.monitored;e.loading=!0;try{const r=await y.post("/api/storage/smart/monitoring",{device:e.device,enabled:t});e.monitored=t,A.success({title:l("storageSmart.title"),message:r.data.message||(e.monitored?l("storageSmart.enableMonitoring"):l("storageSmart.disableMonitoring"))})}catch(r){e.monitored=t,A.error({title:l("storageSmart.title"),message:r.response?.data?.error||l("common.error"),duration:3e3})}finally{e.loading=!1}},Y=e=>{if(!e?.ata_smart_attributes?.table)return 0;const t=e.ata_smart_attributes.table.find(d=>d.id===5),r=e.ata_smart_attributes.table.find(d=>d.id===197),m=e.ata_smart_attributes.table.find(d=>d.id===198);return(t?.raw?.value||0)+(r?.raw?.value||0)+(m?.raw?.value||0)},ee=e=>e?.ata_smart_attributes?.table?e.ata_smart_attributes.table.filter(t=>t.value&&t.thresh&&t.value<=t.thresh).map(t=>({id:t.id,name:t.name,value:t.value,threshold:t.thresh})):[],te=e=>{if(!e)return null;if(e.nvme_smart_health_information_log?.temperature)return e.nvme_smart_health_information_log.temperature-273;if(e.temperature?.current)return e.temperature.current;if(e.ata_smart_attributes?.table){const t=e.ata_smart_attributes.table.find(r=>["Temperature_Celsius","Temperature_Internal"].includes(r.name)||r.id===194);if(t?.raw?.value)return parseInt(t.raw.value)}return null};return ie(async()=>{await x(),k.value.length===0&&!w.value&&(B.value=!0)}),(e,t)=>{const r=f("el-button"),m=f("el-tooltip"),d=f("el-input"),D=f("el-alert"),I=f("el-switch"),g=f("el-table-column"),E=f("el-tag"),ae=f("el-table"),ne=f("el-card"),oe=ce("loading");return c(),b(V,null,[a(ne,{class:"storage-smart-widget"},{header:s(()=>[i("div",pe,[a(o(u),{icon:"mdi:harddisk-check",width:"20",height:"20"}),i("span",null,p(o(l)("storageSmart.title")),1),i("div",ge,[a(m,{content:o(l)("storageSmart.refresh")},{default:s(()=>[a(r,{size:"small",onClick:x,loading:v.value,text:""},{default:s(()=>[a(o(u),{icon:"mdi:refresh",width:"16",height:"16",class:N({spin:v.value})},null,8,["class"])]),_:1},8,["loading"])]),_:1},8,["content"])])])]),default:s(()=>[B.value?(c(),h(D,{key:0,title:o(l)("storageSmart.notAvailableTitle"),type:"warning",description:o(l)("storageSmart.notAvailableMessage"),"show-icon":"",closable:!1,class:"mb-4"},{default:s(()=>[i("p",null,p(o(l)("storageSmart.notAvailableSolution")),1),a(d,{"model-value":o(l)("storageSmart.installCommand"),readonly:"",class:"mb-2"},{append:s(()=>[a(r,{onClick:K,icon:o(me)},null,8,["icon"])]),_:1},8,["model-value"]),a(r,{type:"primary",size:"small",onClick:x},{default:s(()=>[M(p(o(l)("storageSmart.retry")),1)]),_:1})]),_:1},8,["title","description"])):S("",!0),ue((c(),h(ae,{data:k.value,style:{width:"100%"},"row-key":"device","empty-text":L.value},{default:s(()=>[a(g,{label:o(l)("storageSmart.monitored"),width:"120"},{default:s(({row:n})=>[a(I,{modelValue:n.monitored,"onUpdate:modelValue":T=>n.monitored=T,onChange:T=>X(n),loading:n.loading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1},8,["label"]),a(g,{label:o(l)("storageSmart.device"),prop:"device",width:"120"},{default:s(({row:n})=>[i("div",fe,[a(o(u),{icon:j(n.device),width:"18",height:"18"},null,8,["icon"]),i("span",null,p(n.device),1)])]),_:1},8,["label"]),a(g,{label:o(l)("storageSmart.model"),prop:"model"},null,8,["label"]),a(g,{label:o(l)("storageSmart.vendor"),prop:"vendor"},{default:s(({row:n})=>[i("div",_e,[$(n.vendor)?(c(),h(o(u),{key:0,icon:$(n.vendor),width:"18",height:"18"},null,8,["icon"])):S("",!0),i("span",null,p(n.vendor),1)])]),_:1},8,["label"]),a(g,{label:o(l)("storageSmart.serial"),prop:"serial"},null,8,["label"]),a(g,{label:o(l)("storageSmart.wwn"),prop:"wwn"},null,8,["label"]),a(g,{label:o(l)("storageSmart.capacity"),prop:"capacity",width:"120"},{default:s(({row:n})=>[i("div",he,[a(o(u),{icon:"mdi:database",width:"16",height:"16"}),i("span",null,p(W(n.capacity)),1)])]),_:1},8,["label"]),a(g,{label:o(l)("storageSmart.temperature"),prop:"temperature",width:"150"},{default:s(({row:n})=>[n.temperature!==null?(c(),b("div",{key:0,class:N(["temp-cell",H(n.temperature)])},[a(o(u),{icon:"mdi:thermometer",width:"16",height:"16"}),i("span",null,p(n.temperature)+"°C",1),n.rawData?(c(),h(m,{key:0,content:"Zobacz surowe dane SMART",placement:"top"},{default:s(()=>[a(r,{size:"small",circle:"",onClick:T=>F(n),class:"ml-2"},{default:s(()=>[a(o(u),{icon:"mdi:code-braces",width:"14"})]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0)],2)):(c(),b("div",Se,[a(o(u),{icon:"mdi:thermometer-off",width:"16",height:"16"}),i("span",null,p(o(l)("common.na")),1),n.error?(c(),h(m,{key:0,content:n.error,placement:"top"},{default:s(()=>[a(o(u),{icon:"mdi:alert-circle",class:"ml-2"})]),_:2},1032,["content"])):S("",!0)]))]),_:1},8,["label"]),a(g,{label:o(l)("storageSmart.statusS"),prop:"status",width:"150"},{default:s(({row:n})=>[n.available?(c(),b(V,{key:0},[a(E,{type:G(n),effect:"dark"},{default:s(()=>[M(p(Z(n)),1)]),_:2},1032,["type"]),q(n)?(c(),h(m,{key:0,effect:"dark",placement:"top",content:Q(n)},{default:s(()=>[a(o(u),{icon:"mdi:alert-circle",width:"16",style:{color:"var(--el-color-warning)",marginLeft:"8px"}})]),_:2},1032,["content"])):S("",!0)],64)):(c(),b(V,{key:1},[a(E,{type:"info",effect:"dark"},{default:s(()=>[M(p(o(l)("storageSmart.statusValues.unavailable")),1)]),_:1}),n.error?(c(),h(m,{key:0,content:n.error},{default:s(()=>[a(o(u),{icon:"mdi:alert-circle",class:"ml-2"})]),_:2},1032,["content"])):S("",!0)],64))]),_:1},8,["label"]),a(g,{label:"Akcje",width:"120",align:"right"},{default:s(({row:n})=>[a(m,{content:"Pokaż szczegóły",placement:"top"},{default:s(()=>[a(r,{size:"small",circle:"",onClick:T=>J(n.device),class:"action-button"},{default:s(()=>[a(o(u),{icon:"mdi:information-outline",width:"16"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[oe,v.value]]),w.value?(c(),b("div",be,[a(o(u),{icon:"mdi:alert-circle",width:"18",height:"18"}),i("span",null,p(w.value),1)])):S("",!0)]),_:1}),a(o(de),{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=n=>C.value=n),title:"Surowe dane SMART",width:"70%"},{footer:s(()=>[a(r,{onClick:t[0]||(t[0]=n=>C.value=!1)},{default:s(()=>t[2]||(t[2]=[M("Zamknij")])),_:1,__:[2]})]),default:s(()=>[i("pre",null,p(R.value),1)]),_:1},8,["modelValue"])],64)}}}),Ce=re(we,[["__scopeId","data-v-323660ef"]]);export{Ce as default};
