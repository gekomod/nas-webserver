import{_ as Z,c as $,U as le,V as oe,W as ie,b as m,d as h,e as y,g as a,f as u,m as g,w as s,h as V,X as ce,n as P,t as c,k as n,Y as re,r as d,u as de,y as ue,o as pe,K as me,v as ye,i as L,x as ge,I as v,Z as fe,$ as _e,z as M,B as R}from"./index-JqcLm-KS.js";const ve={class:"update-status"},he={key:0,class:"status-container"},we={class:"status-meta"},Ue={class:"status-message"},ke={class:"status-time"},ze={key:1,class:"status-pending"},Se={__name:"UpdateStatus",props:{status:{type:Object,required:!0,default:()=>({progress:0,status:"",message:"",time:"",indeterminate:!1})}},setup(f){const I=f,t=$(()=>({success:"status-icon success",exception:"status-icon error","":"status-icon pending"})[I.status.status]),A=$(()=>({success:ie,exception:oe,"":le})[I.status.status]);return(p,w)=>{const z=m("el-progress"),U=m("el-icon");return y(),h("div",ve,[f.status.progress>0?(y(),h("div",he,[a(z,{percentage:f.status.progress,status:f.status.status,"text-inside":!0,"stroke-width":20,indeterminate:f.status.indeterminate},null,8,["percentage","status","indeterminate"]),u("div",we,[u("span",Ue,[a(U,{class:P(t.value)},{default:s(()=>[(y(),V(ce(A.value)))]),_:1},8,["class"]),g(" "+c(f.status.message),1)]),u("span",ke,c(f.status.time),1)])])):(y(),h("div",ze,[a(U,null,{default:s(()=>[a(n(re))]),_:1}),g(" "+c(f.status.message),1)]))])}}},be=Z(Se,[["__scopeId","data-v-8f79368b"]]),je={systemUpdates:{title:"System Updates",noUpdates:"System is up to date - no updates available",package:"Package",version:"Version",description:"Description",status:"Status",actions:"Actions",details:"Details",install:"Install",installAll:"Install all ({count})",automaticUpdates:"Automatic Updates",updateDetails:"Update Details",currentVersion:"Current Version",newVersion:"New Version",changelog:"Changelog",confirmInstallAll:"Are you sure you want to install all {count} updates?",confirmInstallSingle:"Are you sure you want to install package {name} (version {version})?",confirmTitle:"Confirmation",systemUpToDate:"System is up to date!",checkFailed:"Failed to check for updates: {error}",installFailed:"Installation failed: {error}",startingInstallation:"Starting installation...",installing:"Installing...",pending:"Pending",connectionError:"Connection error",settingsSaved:"Settings saved successfully!",saveFailed:"Failed to save settings: {error}",automaticUpdatesSettings:"Automatic Updates Settings",enableAutomaticUpdates:"Enable automatic updates",updateSchedule:"Update schedule",daily:"Daily",weekly:"Weekly",monthly:"Monthly",updateType:"Update type",securityOnly:"Security only",allUpdates:"All updates",rebootAfterUpdate:"Reboot after update",rebootAfterUpdateHint:"System will automatically reboot after update completes",refresh:"Refresh"},common:{cancel:"Cancel",save:"Save",close:"Close"}},De={systemUpdates:{title:"Aktualizacje systemu",noUpdates:"System jest aktualny - brak dostępnych aktualizacji",package:"Pakiet",version:"Wersja",description:"Opis",status:"Status",actions:"Akcje",details:"Szczegóły",install:"Zainstaluj",installAll:"Zainstaluj wszystkie ({count})",automaticUpdates:"Automatyczne aktualizacje",updateDetails:"Szczegóły aktualizacji",currentVersion:"Aktualna wersja",newVersion:"Nowa wersja",changelog:"Dziennik zmian",confirmInstallAll:"Czy na pewno chcesz zainstalować wszystkie {count} aktualizacje?",confirmInstallSingle:"Czy na pewno chcesz zainstalować pakiet {name} (wersja {version})?",confirmTitle:"Potwierdzenie",systemUpToDate:"System jest aktualny!",checkFailed:"Sprawdzanie aktualizacji nie powiodło się: {error}",installFailed:"Instalacja nie powiodła się: {error}",startingInstallation:"Rozpoczynanie instalacji...",installing:"Instalowanie...",pending:"Oczekujące",connectionError:"Błąd połączenia",settingsSaved:"Ustawienia zapisane pomyślnie!",saveFailed:"Zapisywanie ustawień nie powiodło się: {error}",automaticUpdatesSettings:"Ustawienia automatycznych aktualizacji",enableAutomaticUpdates:"Włącz automatyczne aktualizacje",updateSchedule:"Harmonogram aktualizacji",daily:"Codziennie",weekly:"Tygodniowo",monthly:"Miesięcznie",updateType:"Typ aktualizacji",securityOnly:"Tylko zabezpieczenia",allUpdates:"Wszystkie aktualizacje",rebootAfterUpdate:"Automatyczny restart po aktualizacji",rebootAfterUpdateHint:"System zostanie automatycznie zrestartowany po zakończeniu aktualizacji",refresh:"Odśwież"},common:{cancel:"Anuluj",save:"Zapisz",close:"Zamknij"}},xe={class:"widget-header"},Ie={class:"header-actions"},Ae={class:"table-container"},Ce={class:"package-name"},Te={class:"version-container"},Ee={class:"package-description"},Ve={key:0,class:"description-text"},$e={key:1,class:"no-description"},Be={class:"action-buttons"},Fe={key:1,class:"update-actions"},Le={key:0,class:"update-details"},Oe={class:"version-display"},Ne={class:"description-content"},Me={__name:"Updates",setup(f){const I=d("fixed"),{t,mergeLocaleMessage:A}=de();A("en",je),A("pl",De);const p=d([]),w=d(!1),z=d(!1),U=d(!1),B=d(""),C=d(""),T=d(!1),k=d(null),W=d(!1),S=d({}),_=d({});d(!1),d("daily"),d("security"),d(!1),t("systemUpdates.daily"),t("systemUpdates.weekly"),t("systemUpdates.monthly");const b=ue.create({baseURL:`${window.location.protocol}//${window.location.hostname}:3000`,timeout:3e4}),H=e=>e?e.length>100?`${e.substring(0,100)}...`:e:"",J=$(()=>p.value.length>0);$(()=>B.value?new Date(B.value).toLocaleString():"");const E=async()=>{w.value=!0,C.value="";try{const e=await b.get("/system/updates/check?force=true");p.value=e.data.updates||[],B.value=new Date().toISOString(),J.value||M.success(t("systemUpdates.systemUpToDate"))}catch(e){C.value=t("systemUpdates.checkFailed",{error:e.response?.data?.message||e.message}),console.error("Update check error:",e)}finally{w.value=!1}},q=async()=>{try{await R.confirm(t("systemUpdates.confirmInstallAll",{count:p.value.length}),t("systemUpdates.confirmTitle"),{confirmButtonText:t("systemUpdates.install"),cancelButtonText:t("common.cancel"),type:"warning"}),U.value=!0;const e=p.value.map(i=>i.name);p.value.forEach(i=>{O(i.name)}),await b.post("/system/updates/install",{packages:e,no_confirm:!0});const l=new EventSource(`${b.defaults.baseURL}/system/updates/progress/_all`);_.value._all=l,l.onmessage=i=>{const o=JSON.parse(i.data);p.value.forEach(F=>{j(F.name,{progress:o.progress,status:o.status||"",message:o.message||t("systemUpdates.installing"),indeterminate:o.progress<30})}),o.progress===100&&setTimeout(()=>{l.close(),delete _.value._all,E()},1500)},l.onerror=i=>{console.error("SSE Error:",i),p.value.forEach(o=>{j(o.name,{progress:0,status:"exception",message:t("systemUpdates.connectionError")})}),l.close(),delete _.value._all}}catch(e){e!=="cancel"&&M.error(t("systemUpdates.installFailed",{error:e.response?.data?.message||e.message}))}finally{U.value=!1}},K=async e=>{if(e)try{await R.confirm(t("systemUpdates.confirmInstallSingle",{name:e.name,version:e.new_version}),t("systemUpdates.confirmTitle"),{confirmButtonText:t("systemUpdates.install"),cancelButtonText:t("common.cancel"),type:"info"}),O(e.name),z.value=!0,await b.post("/system/updates/install",{packages:[e.name],no_confirm:!0});const l=new EventSource(`${b.defaults.baseURL}/system/updates/progress/${e.name}`);_.value[e.name]=l,l.onmessage=i=>{try{const o=JSON.parse(i.data);j(e.name,{progress:o.progress,status:o.status||"",message:o.message||t("systemUpdates.installing"),indeterminate:o.progress<30}),o.progress===100&&setTimeout(()=>{l.close(),delete _.value[e.name],E()},1500)}catch(o){console.error("Error parsing SSE data:",o)}},l.onerror=i=>{console.error("SSE Error:",i),j(e.name,{progress:0,status:"exception",message:t("systemUpdates.connectionError")}),l.close(),delete _.value[e.name]}}catch(l){l!=="cancel"&&j(e.name,{progress:0,status:"exception",message:l.response?.data?.message||l.message})}finally{z.value=!1}},X=e=>S.value[e]||{progress:0,status:"",message:t("systemUpdates.pending"),time:""},O=e=>{S.value[e]={progress:0,status:"",message:t("systemUpdates.startingInstallation"),time:new Date().toLocaleTimeString(),indeterminate:!0}},j=(e,l)=>{S.value[e]={...S.value[e]||{},...l,time:new Date().toLocaleTimeString(),indeterminate:l.progress===0&&l.message.includes("Downloading")}},Y=e=>{k.value={...e,fullDescription:e.description},T.value=!0},G=()=>{W.value=!0};return pe(()=>{E()}),me(()=>{Object.values(_.value).forEach(e=>e.close())}),(e,l)=>{const i=m("el-button"),o=m("el-tooltip"),F=m("el-alert"),D=m("el-table-column"),x=m("el-tag"),Q=m("el-table"),N=m("el-icon"),ee=m("el-divider"),te=m("el-dialog"),ae=m("el-card"),se=ye("loading");return y(),V(ae,{class:"updates-widget"},{header:s(()=>[u("div",xe,[a(n(v),{icon:"mdi:update",width:"20",height:"20"}),u("span",null,c(n(t)("systemUpdates.title")),1),u("div",Ie,[a(o,{content:n(t)("systemUpdates.refresh")},{default:s(()=>[a(i,{size:"small",onClick:E,loading:w.value,text:""},{default:s(()=>[a(n(v),{icon:"mdi:refresh",width:"16",height:"16",class:P({spin:w.value})},null,8,["class"])]),_:1},8,["loading"])]),_:1},8,["content"])])])]),default:s(()=>[C.value?(y(),V(F,{key:0,title:C.value,type:"error","show-icon":"",style:{margin:"0 16px 16px"}},null,8,["title"])):L("",!0),u("div",Ae,[ge((y(),V(Q,{data:p.value,style:{width:"100%"},"empty-text":n(t)("systemUpdates.noUpdates"),class:"full-width-table",layout:I.value},{default:s(()=>[a(D,{prop:"name",label:n(t)("systemUpdates.package"),width:"220","min-width":"180",fixed:"left"},{default:s(({row:r})=>[u("div",Ce,[a(n(v),{icon:"mdi:package-variant",width:"16"}),u("span",null,c(r.name),1)])]),_:1},8,["label"]),a(D,{label:n(t)("systemUpdates.version"),width:"330","min-width":"160"},{default:s(({row:r})=>[u("div",Te,[a(x,{size:"small",effect:"plain"},{default:s(()=>[g(c(r.current_version),1)]),_:2},1024),a(n(v),{icon:"mdi:arrow-right",width:"16"}),a(x,{size:"small",type:"success",effect:"dark"},{default:s(()=>[g(c(r.new_version),1)]),_:2},1024)])]),_:1},8,["label"]),a(D,{prop:"description",label:n(t)("systemUpdates.description"),"min-width":"300"},{default:s(({row:r})=>[u("div",Ee,[r.description?(y(),h("div",Ve,c(H(r.description)),1)):(y(),h("div",$e,[a(x,{size:"small",type:"info"},{default:s(()=>[g(c(n(t)("systemUpdates.noDescription")),1)]),_:1})]))])]),_:1},8,["label"]),a(D,{label:n(t)("systemUpdates.status"),width:"220","min-width":"180"},{default:s(({row:r})=>[a(be,{status:X(r.name)},null,8,["status"])]),_:1},8,["label"]),a(D,{label:n(t)("systemUpdates.actions"),width:"180","min-width":"150",fixed:"right",align:"center"},{default:s(({row:r})=>[u("div",Be,[a(o,{content:n(t)("systemUpdates.details"),placement:"top"},{default:s(()=>[a(i,{size:"small",type:"info",onClick:ne=>Y(r),circle:""},{default:s(()=>[a(n(v),{icon:"mdi:information-outline",width:"16"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),a(o,{content:n(t)("systemUpdates.install"),placement:"top"},{default:s(()=>[a(i,{size:"small",type:"success",onClick:ne=>K(r),loading:S.value[r.name]?.progress>0,circle:""},{default:s(()=>[a(n(v),{icon:"mdi:package-down",width:"16"})]),_:2},1032,["onClick","loading"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","empty-text","layout"])),[[se,w.value]])]),p.value.length>0?(y(),h("div",Fe,[a(i,{type:"primary",onClick:q,loading:U.value,disabled:z.value||p.value.length===0,class:"install-all-btn"},{default:s(()=>[a(N,{class:"el-icon--left"},{default:s(()=>[a(n(fe))]),_:1}),g(" "+c(n(t)("systemUpdates.installAll",{count:p.value.length})),1)]),_:1},8,["loading","disabled"]),a(i,{type:"info",onClick:G,plain:""},{default:s(()=>[a(N,{class:"el-icon--left"},{default:s(()=>[a(n(_e))]),_:1}),g(" "+c(n(t)("systemUpdates.automaticUpdates")),1)]),_:1})])):L("",!0),a(te,{modelValue:T.value,"onUpdate:modelValue":l[1]||(l[1]=r=>T.value=r),title:n(t)("systemUpdates.updateDetails"),width:"50%"},{footer:s(()=>[a(i,{onClick:l[0]||(l[0]=r=>T.value=!1)},{default:s(()=>[g(c(n(t)("common.close")),1)]),_:1})]),default:s(()=>[k.value?(y(),h("div",Le,[u("h3",null,c(k.value.name),1),u("div",Oe,[a(x,{size:"medium",effect:"plain"},{default:s(()=>[g(c(k.value.current_version),1)]),_:1}),a(n(v),{icon:"mdi:arrow-right",width:"20"}),a(x,{size:"medium",type:"success",effect:"dark"},{default:s(()=>[g(c(k.value.new_version),1)]),_:1})]),a(ee),u("h4",null,c(n(t)("systemUpdates.description")),1),u("div",Ne,c(k.value.fullDescription||n(t)("systemUpdates.noDescription")),1)])):L("",!0)]),_:1},8,["modelValue","title"])]),_:1})}}},Ze=Z(Me,[["__scopeId","data-v-be111409"]]);export{Ze as default};
