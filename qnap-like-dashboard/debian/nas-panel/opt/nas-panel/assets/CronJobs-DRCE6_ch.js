import{_ as P,u as Z,r as m,o as K,b as i,v as T,d as G,e as C,g as l,w as n,f as t,x as Q,m as s,k as J,a0 as W,t as u,h as D,n as X,i as Y,I as R,y as g,z as r,B as ee,a1 as le}from"./index-JqcLm-KS.js";const oe={cronJobs:{title:"Cron Jobs",addJob:"Add Job",name:"Name",schedule:"Schedule",description:"Description",command:"Command",status:"Status",lastRun:"Last Run",nextRun:"Next Run",actions:"Actions",active:"Active",inactive:"Inactive",run:"Run Now",delete:"Delete"},common:{add:"Add",cancel:"Cancel"}},ae={cronJobs:{title:"Zadania Cron",addJob:"Dodaj Zadanie",name:"Nazwa",schedule:"Harmonogram",description:"Opis",command:"Polecenie",status:"Status",lastRun:"Ostatnie wykonanie",nextRun:"Następne wykonanie",actions:"Akcje",active:"Aktywne",inactive:"Nieaktywne",run:"Uruchom",delete:"Usuń"},common:{add:"Dodaj",cancel:"Anuluj"}},ne={class:"cron-jobs"},te={class:"card-header"},se={class:"actions"},de={__name:"CronJobs",setup(ie){const{addNotification:S}=le(),{t:U,mergeLocaleMessage:A}=Z();A("en",oe),A("pl",ae);const $=m([]),w=m(!1),p=m(!1),h=m(!1),V=m(!1),k=m({}),d=m({name:"",schedule:"",command:"",description:""}),z=e=>new Date(e).toLocaleString(),v=async()=>{w.value=!0;try{const e=await g.get("/system/cron-jobs");$.value=e.data.map(a=>({...a,nextRun:a.nextRun?new Date(a.nextRun):null,lastRun:a.lastRun?new Date(a.lastRun):null,isActive:a.isActive!==void 0?a.isActive:!0}))}catch(e){r.error(U("cronJobs.fetchError")),console.error(e)}finally{w.value=!1}},B=()=>{d.value={name:"",schedule:"",command:"",description:""},p.value=!0},I=async()=>{V.value=!0;try{await g.post("/system/cron-jobs",d.value),S({title:"Cron Job Added",message:"A new cron job has been successfully added.",type:"success"}),r.success("Job added successfully"),p.value=!1,await v()}catch(e){r.error(e.response?.data?.error||"Failed to add job")}finally{V.value=!1}},L=async e=>{try{if($.value.find(f=>f.id===e)?.isSystemJob){r.warning("System jobs cannot be deleted");return}await ee.confirm("Are you sure you want to delete this cron job?","Confirm",{type:"warning"}),await g.delete(`/system/cron-jobs/${e}`),r.success("Job deleted"),await v()}catch(a){a!=="cancel"&&r.error("Failed to delete job")}},E=async e=>{k.value[e]=!0;try{await g.post(`/system/cron-jobs/${e}/run`),r.success("Job executed"),await v()}catch{r.error("Job execution failed")}finally{k.value[e]=!1}};return K(()=>{v()}),(e,a)=>{const f=i("el-icon"),b=i("el-button"),c=i("el-table-column"),N=i("el-tag"),M=i("el-text"),q=i("el-table"),x=i("el-card"),y=i("el-input"),_=i("el-form-item"),F=i("el-form"),j=i("el-dialog"),H=T("loading");return C(),G("div",ne,[l(x,{shadow:"hover"},{header:n(()=>[t("div",te,[l(f,{size:"24"},{default:n(()=>[l(J(R),{icon:"mdi:clock-outline"})]),_:1}),t("span",null,u(e.$t("cronJobs.title")),1)])]),default:n(()=>[t("div",se,[l(b,{type:"primary",onClick:B},{default:n(()=>[l(f,{class:"el-icon--left"},{default:n(()=>[l(J(W))]),_:1}),s(" "+u(e.$t("cronJobs.addJob")),1)]),_:1})]),Q((C(),D(q,{data:$.value,"empty-text":"No cron jobs",style:{width:"100%"}},{default:n(()=>[l(c,{prop:"name",label:e.$t("cronJobs.name")},null,8,["label"]),l(c,{label:e.$t("cronJobs.schedule")},{default:n(({row:o})=>[l(N,null,{default:n(()=>[s(u(o.schedule),1)]),_:2},1024)]),_:1},8,["label"]),l(c,{prop:"description",label:e.$t("cronJobs.description")},null,8,["label"]),l(c,{label:e.$t("cronJobs.command"),width:"300"},{default:n(({row:o})=>[l(M,{truncated:""},{default:n(()=>[s(u(o.command),1)]),_:2},1024)]),_:1},8,["label"]),l(c,{label:e.$t("cronJobs.status")},{default:n(({row:o})=>[l(N,{type:o.isActive?"success":"info",class:X({"system-job":o.isSystemJob})},{default:n(()=>[s(u(o.isActive?e.$t("cronJobs.active"):e.$t("cronJobs.inactive"))+" ",1),o.isSystemJob?(C(),D(f,{key:0,class:"system-icon"},{default:n(()=>[l(J(R),{icon:"mdi:shield-check"})]),_:1})):Y("",!0)]),_:2},1032,["type","class"])]),_:1},8,["label"]),l(c,{label:e.$t("cronJobs.lastRun")},{default:n(({row:o})=>[s(u(o.lastRun?z(o.lastRun):"N/A"),1)]),_:1},8,["label"]),l(c,{label:e.$t("cronJobs.nextRun")},{default:n(({row:o})=>[s(u(o.nextRun?z(o.nextRun):"N/A"),1)]),_:1},8,["label"]),l(c,{label:e.$t("cronJobs.actions"),width:"180"},{default:n(({row:o})=>[l(b,{size:"small",onClick:O=>E(o.id),loading:k.value[o.id]},{default:n(()=>[s(u(e.$t("cronJobs.run")),1)]),_:2},1032,["onClick","loading"]),l(b,{size:"small",type:"danger",onClick:O=>L(o.id)},{default:n(()=>[s(u(e.$t("cronJobs.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[H,w.value]])]),_:1}),l(j,{modelValue:p.value,"onUpdate:modelValue":a[6]||(a[6]=o=>p.value=o),title:e.$t("cronJobs.addJob")},{footer:n(()=>[l(b,{onClick:a[5]||(a[5]=o=>p.value=!1)},{default:n(()=>[s(u(e.$t("common.cancel")),1)]),_:1}),l(b,{type:"primary",onClick:I,loading:V.value},{default:n(()=>[s(u(e.$t("common.add")),1)]),_:1},8,["loading"])]),default:n(()=>[l(F,{model:d.value,"label-position":"top"},{default:n(()=>[l(_,{label:e.$t("cronJobs.name"),required:""},{default:n(()=>[l(y,{modelValue:d.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>d.value.name=o)},null,8,["modelValue"])]),_:1},8,["label"]),l(_,{label:e.$t("cronJobs.schedule"),required:""},{default:n(()=>[l(y,{modelValue:d.value.schedule,"onUpdate:modelValue":a[2]||(a[2]=o=>d.value.schedule=o),placeholder:"* * * * *"},{append:n(()=>[l(b,{onClick:a[1]||(a[1]=o=>h.value=!0)},{default:n(()=>[l(J(R),{icon:"mdi:help-circle"})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(_,{label:e.$t("cronJobs.command"),required:""},{default:n(()=>[l(y,{modelValue:d.value.command,"onUpdate:modelValue":a[3]||(a[3]=o=>d.value.command=o),type:"textarea",rows:3,placeholder:"np: curl http://example.com/api/ping"},null,8,["modelValue"])]),_:1},8,["label"]),l(_,{label:e.$t("cronJobs.description")},{default:n(()=>[l(y,{modelValue:d.value.description,"onUpdate:modelValue":a[4]||(a[4]=o=>d.value.description=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(j,{modelValue:h.value,"onUpdate:modelValue":a[7]||(a[7]=o=>h.value=o),title:"Składnia cron"},{default:n(()=>a[8]||(a[8]=[t("div",{class:"cron-help"},[t("p",null,"Przykładowe formaty:"),t("ul",null,[t("li",null,[t("strong",null,"* * * * *"),s(" - co minutę")]),t("li",null,[t("strong",null,"*/5 * * * *"),s(" - co 5 minut")]),t("li",null,[t("strong",null,"0 * * * *"),s(" - co godzinę")]),t("li",null,[t("strong",null,"0 0 * * *"),s(" - codziennie o północy")]),t("li",null,[t("strong",null,"0 0 * * 0"),s(" - co niedzielę o północy")])]),t("p",null,"Kolejność pól: minuta (0-59), godzina (0-23), dzień miesiąca (1-31), miesiąc (1-12), dzień tygodnia (0-7, gdzie 0 i 7 to niedziela)")],-1)])),_:1,__:[8]},8,["modelValue"])])}}},ce=P(de,[["__scopeId","data-v-2edaf532"]]);export{ce as default};
