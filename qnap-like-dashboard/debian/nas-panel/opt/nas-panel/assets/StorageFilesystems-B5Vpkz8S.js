import{_ as lt,r as m,u as at,y as T,c as x,C as we,o as st,Q as ot,b as h,v as it,d as V,e as n,g as a,w as s,x as nt,i as D,h as f,F as S,l as E,m as v,t as r,f as g,k as F,I as $,n as ut,B as re,E as z,z as rt}from"./index-JqcLm-KS.js";const dt={class:"widget-header"},mt={class:"header-actions"},ct={class:"fstab-editor-container"},pt={class:"editor-actions",style:{"margin-top":"15px"}},ft={key:0,class:"warning-message"},vt={class:"device-cell"},gt={class:"size-cell"},yt={class:"mount-cell"},bt={key:0,class:"read-only-badge"},ht={key:0,class:"error-message"},wt={class:"disk-usage-container"},kt={class:"disk-size-info"},zt={class:"partition-list"},Ft={class:"partition-size-info"},$t={name:"StorageFilesystemsWidget",displayName:"Systemy plików"},Vt=Object.assign($t,{setup(_t){const j=m(new AbortController),{t:M}=at(),G=T.create({baseURL:`${window.location.protocol}//${window.location.hostname}:3000`,signal:j.value.signal}),R=m([]),L=m([]),b=m(!1),U=m(null),ee=m(!1),te=m(""),N=m(!1),oe=m([]),W=m(!1),ie=m(!1),u=m({device:"",partition:"",mountPoint:"",fsType:"ext4",options:"defaults,nofail",zfsPoolName:""}),O=m(!1),ne=m(!1),c=m({device:"",fsType:"ext4",label:"",zfsPoolName:"zpool",force:!1}),de=m(["bcachefs","btrfs","ext4","f2fs","jfs","xfs","zfs"]),w=m(0),le=m(0),K=m(0),Y=m(!1),_=m({level:"1",devices:[],name:""}),ke=x(()=>L.value.filter(e=>!e.path.includes("md")&&!e.path.includes("loop")&&!e.mountpoint)),ze=()=>{Y.value=!0,_.value={level:"1",devices:[],name:""}},Fe=async()=>{try{const e=await G.get("/api/storage/fstab-check");oe.value=e.data.entries}catch(e){console.error("Error loading fstab entries:",e)}},$e=(e,l)=>oe.value.some(o=>{const d=o.device===e||e.includes(o.device)||o.device.includes(e),i=o.mountPoint===l;return d||i});x(()=>L.value.flatMap(e=>{const l={path:e.path,model:e.model,type:e.type},o=e.partitions?.map(d=>({path:d.path,model:e.model,type:d.type}))||[];return[l,...o]}).filter(e=>!e.path.includes("loop")));const me=x(()=>{const e=R.value.map(l=>l.device);return L.value.filter(l=>!e.includes(l.path)&&!l.path.includes("loop")&&!l.path.includes("ram")&&l.type==="disk"&&!q(l.path))}),Ve=x(()=>{const e=R.value.map(l=>l.device);return L.value.flatMap(l=>(l.partitions||[]).filter(o=>!e.includes(o.path)&&!o.path.includes("loop")&&!o.path.includes("ram")).map(o=>({...o,model:l.model||"Unknown"})))});function q(e){return["/dev/sda","/dev/nvme0n1"].some(o=>e.startsWith(o))}const ae=m([]),_e=e=>{const l=L.value.find(o=>o.path===e);ae.value=l?.partitions||[],u.value.partition=ae.value[0]?.path||""},ce=async()=>{try{N.value=!0;const e=await G.get("/api/storage/fstab-content");te.value=e.data.content}catch(e){z({title:"Error",message:e.response?.data?.details||e.message,type:"error"})}finally{N.value=!1}},De=async()=>{try{N.value=!0,await G.post("/api/storage/save-fstab",{content:te.value}),z({title:"Success",message:"Fstab saved successfully",type:"success"}),ee.value=!1}catch(e){z({title:"Error",message:e.response?.data?.details||e.message,type:"error"})}finally{N.value=!1}},Ce=async()=>{try{await re.confirm("You are about to edit system fstab file. Make sure you know what you are doing.","Warning",{confirmButtonText:"Continue",cancelButtonText:"Cancel",type:"warning"}),ee.value=!0,await ce()}catch(e){e!=="cancel"&&z({title:"Error",message:e.message,type:"error"})}},Ue=async()=>{try{if(_.value.devices.length<2)throw new Error(M("storageFilesystems.raidDialog.minDevicesError"));(await T.post("/api/storage/create-raid",{devices:_.value.devices,raidLevel:_.value.level,name:_.value.name})).data.success&&(z({title:M("common.success"),message:M("storageFilesystems.raidDialog.createSuccess"),type:"success"}),Y.value=!1,await A())}catch(e){z({title:M("common.error"),message:e.response?.data?.details||e.message,type:"error"})}},Pe=async()=>{try{b.value=!0,await A(),W.value=!0}catch(e){U.value=M("storageFilesystems.errorLoadingDevices"),console.error("Error loading devices:",e)}finally{b.value=!1}},Te=async()=>{try{b.value=!0,await A(),O.value=!0}catch(e){U.value=M("storageFilesystems.errorLoadingDevices"),console.error("Error loading devices:",e)}finally{b.value=!1}},pe=async(e,l,o,d,i)=>{try{const k=await T.post("/api/storage/fstab",{action:i?"add":"remove",device:e,mountPoint:l,fsType:o,options:d});if(k.data.success){const p=R.value.findIndex(C=>C.device===e&&C.mounted===l);return p!==-1&&(R.value[p].inFstab=i),z({title:"Success",message:k.data.message,type:"success"}),!0}return!1}catch(k){return z({title:"Error",message:k.response?.data?.details||k.message,type:"error"}),!1}},Se=async()=>{try{ie.value=!0,U.value=null;const e=u.value.partition||u.value.device,l=u.value.fsType==="zfs",o=l&&!u.value.mountPoint?u.value.zfsPoolName||"zpool":u.value.mountPoint;let d=!1;if(!l)try{await re.confirm("Czy dodać to montowanie do /etc/fstab dla automatycznego montowania przy starcie systemu?","Dodawanie do fstab",{confirmButtonText:"Tak, dodaj do fstab",cancelButtonText:"Nie",type:"info"}),d=!0}catch{}await A();const i=await T.post("/api/storage/mount",{device:e,mountPoint:o,fsType:u.value.fsType,options:u.value.options,zfsPoolName:u.value.zfsPoolName});i.data.success&&(d&&!i.data.addedToFstab&&!l&&await pe(e,o,u.value.fsType,u.value.options,!0),z({title:"Success",message:i.data.isZfs?`ZFS pool ${u.value.zfsPoolName||"zpool"} mounted successfully`:"Device mounted successfully",type:"success"}),W.value=!1,await Z())}catch(e){U.value=e.response?.data?.details||e.message,z({title:"Mount Error",message:U.value,type:"error",duration:0})}finally{ie.value=!1}},Ee=async()=>{try{if(ne.value=!0,c.value.fsType==="zfs"){const l=c.value.device.replace(/[0-9]+$/,"");try{await re.confirm(`<strong>UWAGA: ZFS wymaga całego dysku!</strong><br><br>
          Będziemy używać <strong>${l}</strong> zamiast ${c.value.device}.<br>
          <span style="color:red;">WSZYSTKIE DANE NA DYSKU ZOSTANĄ USUNIĘTE.</span><br><br>
          Kontynuować?`,"Potwierdzenie tworzenia ZFS",{confirmButtonText:"Tak, utwórz ZFS",cancelButtonText:"Anuluj",type:"error",dangerouslyUseHTMLString:!0})}catch{return}}const e=await T.post("/api/storage/format",{device:c.value.device,fsType:c.value.fsType,label:c.value.zfsPoolName,force:!0});z.success({title:"Sukces",message:`Utworzono ${c.value.fsType.toUpperCase()} na ${e.data.deviceUsed}`,duration:5e3}),O.value=!1,await Z()}catch(e){let l=e.response?.data?.details||e.message;l.includes("no such device")&&(l=`Urządzenie ${e.response?.data?.targetDevice} nie istnieje`),z.error({title:"Błąd formatowania",message:l,duration:0})}finally{ne.value=!1}},Me=async e=>{try{b.value=!0;const l=await T.post("/api/storage/unmount",{mountPoint:e});z({title:"Success",message:l.data.isZfs?"ZFS pool unmounted successfully":"Filesystem unmounted successfully",type:"success"}),await Z()}catch(l){U.value=l.response?.data?.details||l.message,z({title:"Unmount Error",message:U.value,type:"error",duration:0})}finally{b.value=!1}},A=async()=>{try{const e=await T.get("/api/storage/devices");L.value=e.data.data||[]}catch(e){throw console.error("Error fetching devices:",e),e}},Z=async()=>{j.value.abort(),j.value=new AbortController,G.defaults.signal=j.value.signal;try{b.value=!0;const[e,l]=await Promise.all([G.get("/api/storage/filesystems"),G.get("/api/storage/fstab-check")]);Array.isArray(e.data?.data)&&(R.value=e.data.data.map(o=>({...o,inFstab:$e(o.device,o.mounted),fstabLoading:!1}))),oe.value=l.data.entries||[]}catch(e){T.isCancel(e)||(e.value=M("storageFilesystems.errorLoading"),console.error("Error fetching filesystems:",e))}finally{b.value=!1}},Be=e=>e?.includes("nvme")?"mdi:memory":e?.includes("sd")||e?.includes("hd")?"mdi:harddisk":e?.includes("md")?"mdi:raid":e?.includes("zfs")?"mdi:database":"mdi:harddisk",Le=e=>({ext4:"mdi:linux",xfs:"mdi:file-tree",ntfs:"mdi:windows",fat:"mdi:usb-flash-drive",zfs:"mdi:database",btrfs:"mdi:database",bcachefs:"mdi:database",f2fs:"mdi:flash",jfs:"mdi:file-tree"})[e.toLowerCase()]||"mdi:file-question",Ne=e=>({active:"mdi:check-circle",inactive:"mdi:close-circle",readonly:"mdi:lock",error:"mdi:alert-circle",unknown:"mdi:help-circle"})[e.toLowerCase()]||"mdi:help-circle",Ae=e=>({active:"success",inactive:"info",readonly:"warning",error:"danger",unknown:""})[e.toLowerCase()]||"",fe=e=>e>90?"#F56C6C":e>70?"#E6A23C":"#67C23A",H=(e,l=2)=>{if(!e)return"0 Bytes";const o=1024,d=["Bytes","KB","MB","GB","TB"],i=Math.floor(Math.log(e)/Math.log(o));return parseFloat((e/Math.pow(o,i)).toFixed(l))+" "+d[i]},Q=m(!1),ue=m(!1),y=m({device:"",scheme:"gpt",partitions:[{size:100,unit:"%",type:"8300"}]}),Ie=x(()=>L.value.filter(e=>e.type==="disk"&&!e.path.includes("loop")&&!q(e.path))),Ge=async()=>{try{b.value=!0,await A(),Q.value=!0}catch(e){U.value=M("storageFilesystems.errorLoadingDevices"),console.error("Error loading devices:",e)}finally{b.value=!1}},Re=()=>{y.value.partitions.push({size:10,unit:"G",type:"8300"})},Ze=e=>{y.value.partitions.splice(e,1)},je=e=>{q(e)&&rt.warning("This appears to be a system disk. Partitioning system disks is not recommended.")},We=async()=>{try{if(ue.value=!0,Qe(),q(y.value.device))throw new Error("Cannot partition system disk");let e=`sudo sgdisk --zap-all ${y.value.device} && `;e+=`sudo parted -s ${y.value.device} mklabel ${y.value.scheme} && `,y.value.partitions.forEach((o,d)=>{const i=o.unit==="%"?`${o.size}%`:`${o.size}${o.unit}`;e+=`sudo sgdisk -n ${d+1}:0:+${i} -t ${d+1}:${o.type} ${y.value.device} && `}),e+=`sudo partprobe ${y.value.device}`;const l=await T.post("/api/storage/exec-command",{command:e,timeout:6e4});z({title:"Success",message:"Partitions created successfully",type:"success"}),Q.value=!1,await A(),await Z()}catch(e){z({title:"Error",message:e.response?.data?.details||e.message,type:"error"})}finally{ue.value=!1}},Oe=async e=>{try{const l=await T.get("/api/storage/disk-size",{params:{device:e}});w.value=l.data.size,ve()}catch(l){console.error("Error getting disk size:",l),w.value=0}},ve=()=>{let e=0;y.value.partitions.forEach(l=>{l.unit==="%"?e+=l.size/100*w.value:l.unit==="G"?e+=l.size*1024*1024*1024:e+=l.size*1024*1024}),le.value=Math.min(e,w.value),K.value=Math.round(le.value/w.value*100)},Ke=e=>{if(e.unit==="%"){const l=e.size/100*w.value;return H(l)}else return e.unit==="G"?`${e.size} GB`:`${e.size} MB`},Ye=e=>e.unit==="%"?100:e.unit==="G"?Math.floor(w.value/(1024*1024*1024)):Math.floor(w.value/(1024*1024)),qe=e=>!w.value||e==="%"?100:Math.floor(e==="G"?w.value/(1024*1024*1024):w.value/(1024*1024)),He=(e,l)=>{const o=e.unit;if(e.unit=l,o==="%"&&l!=="%"){const i=e.size/100*w.value;l==="G"?e.size=Math.floor(i/(1024*1024*1024)):e.size=Math.floor(i/(1024*1024))}else if(o!=="%"&&l==="%"){const i=o==="G"?e.size*1024*1024*1024:e.size*1024*1024;e.size=Math.floor(i/w.value*100)}const d=qe(l);e.size>d&&(e.size=d)},Qe=()=>{let e=0,l=0;for(const o of y.value.partitions)if(o.unit==="%")e+=o.size;else{const d=o.unit==="G"?o.size*1024*1024*1024:o.size*1024*1024;l+=d}if(e>100)throw new Error("Suma partycji procentowych nie może przekroczyć 100%");if(l>w.value)throw new Error("Suma partycji nie może przekroczyć rozmiaru dysku");return!0};return we(()=>y.value.device,e=>{e?Oe(e):(w.value=0,le.value=0,K.value=0)}),we(()=>y.value.partitions,()=>{ve()},{deep:!0}),st(()=>{Z(),A(),Fe()}),ot(()=>{j.value.abort()}),(e,l)=>{const o=h("el-button"),d=h("el-tooltip"),i=h("el-option"),k=h("el-select"),p=h("el-form-item"),C=h("el-input"),se=h("el-form"),J=h("el-dialog"),ge=h("el-alert"),ye=h("el-switch"),X=h("el-tag"),P=h("el-table-column"),be=h("el-progress"),Je=h("el-table"),Xe=h("el-card"),he=h("el-radio"),xe=h("el-radio-group"),et=h("el-input-number"),tt=it("loading");return n(),V(S,null,[a(Xe,{class:"filesystems-widget"},{header:s(()=>[g("div",dt,[a(F($),{icon:"mdi:file-tree",width:"20",height:"20"}),g("span",null,r(e.$t("storageFilesystems.title")),1),g("div",mt,[a(d,{content:e.$t("storageFilesystems.mount")},{default:s(()=>[a(o,{size:"small",onClick:Pe,disabled:b.value,text:""},{default:s(()=>[a(F($),{icon:"mdi:usb-flash-drive",width:"16",height:"16"})]),_:1},8,["disabled"])]),_:1},8,["content"]),a(d,{content:e.$t("storageFilesystems.format")},{default:s(()=>[a(o,{size:"small",onClick:Te,disabled:b.value,text:""},{default:s(()=>[a(F($),{icon:"mdi:format-list-checks",width:"16",height:"16"})]),_:1},8,["disabled"])]),_:1},8,["content"]),a(d,{content:e.$t("storageFilesystems.refresh")},{default:s(()=>[a(o,{size:"small",onClick:Z,loading:b.value,text:""},{default:s(()=>[a(F($),{icon:"mdi:refresh",width:"16",height:"16",class:ut({spin:b.value})},null,8,["class"])]),_:1},8,["loading"])]),_:1},8,["content"]),a(d,{content:e.$t("storageFilesystems.createRaid")},{default:s(()=>[a(o,{size:"small",onClick:ze,disabled:b.value,text:""},{default:s(()=>[a(F($),{icon:"mdi:disk",width:"16",height:"16"})]),_:1},8,["disabled"])]),_:1},8,["content"]),a(d,{content:e.$t("storageFilesystems.partition")},{default:s(()=>[a(o,{size:"small",onClick:Ge,disabled:b.value,text:""},{default:s(()=>[a(F($),{icon:"mdi:harddisk-plus",width:"16",height:"16"})]),_:1},8,["disabled"])]),_:1},8,["content"]),a(d,{content:e.$t("storageFilesystems.editFstab")},{default:s(()=>[a(o,{size:"small",onClick:Ce,disabled:b.value,text:""},{default:s(()=>[a(F($),{icon:"mdi:file-edit",width:"16",height:"16"})]),_:1},8,["disabled"])]),_:1},8,["content"])])])]),default:s(()=>[a(J,{modelValue:W.value,"onUpdate:modelValue":l[7]||(l[7]=t=>W.value=t),title:e.$t("storageFilesystems.mountDialog.title"),width:"500px"},{footer:s(()=>[a(o,{onClick:l[6]||(l[6]=t=>W.value=!1)},{default:s(()=>[v(r(e.$t("common.cancel")),1)]),_:1}),a(o,{type:"primary",onClick:Se,loading:ie.value},{default:s(()=>[v(r(e.$t("storageFilesystems.mountDialog.mount")),1)]),_:1},8,["loading"])]),default:s(()=>[a(se,{model:u.value,"label-position":"top"},{default:s(()=>[a(p,{label:e.$t("storageFilesystems.mountDialog.device")},{default:s(()=>[a(k,{modelValue:u.value.device,"onUpdate:modelValue":l[0]||(l[0]=t=>u.value.device=t),placeholder:e.$t("storageFilesystems.mountDialog.selectDevice"),onChange:_e,style:{width:"100%"}},{default:s(()=>[(n(!0),V(S,null,E(me.value,t=>(n(),f(i,{key:t.path,label:`${t.path} (${t.model||"Unknown"})`,value:t.path},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),ae.value.length>0?(n(),f(p,{key:0,label:e.$t("storageFilesystems.mountDialog.partition")},{default:s(()=>[a(k,{modelValue:u.value.partition,"onUpdate:modelValue":l[1]||(l[1]=t=>u.value.partition=t),placeholder:"Select partition",style:{width:"100%"}},{default:s(()=>[(n(!0),V(S,null,E(ae.value,t=>(n(),f(i,{key:t.path,label:t.path,value:t.path},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):D("",!0),u.value.fsType!=="zfs"?(n(),f(p,{key:1,label:e.$t("storageFilesystems.mountDialog.mountPoint")},{default:s(()=>[a(C,{modelValue:u.value.mountPoint,"onUpdate:modelValue":l[2]||(l[2]=t=>u.value.mountPoint=t),placeholder:"/mnt/new_disk"},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0),a(p,{label:e.$t("storageFilesystems.mountDialog.fsType")},{default:s(()=>[a(k,{modelValue:u.value.fsType,"onUpdate:modelValue":l[3]||(l[3]=t=>u.value.fsType=t),placeholder:e.$t("storageFilesystems.mountDialog.selectFsType"),style:{width:"100%"}},{default:s(()=>[(n(!0),V(S,null,E(de.value,t=>(n(),f(i,{key:t,label:t,value:t.toLowerCase()},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u.value.fsType==="zfs"?(n(),f(p,{key:2,label:e.$t("storageFilesystems.mountDialog.zfsPoolName")},{default:s(()=>[a(C,{modelValue:u.value.zfsPoolName,"onUpdate:modelValue":l[4]||(l[4]=t=>u.value.zfsPoolName=t),placeholder:"mypool"},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0),u.value.fsType!=="zfs"?(n(),f(p,{key:3,label:e.$t("storageFilesystems.mountDialog.options")},{default:s(()=>[a(C,{modelValue:u.value.options,"onUpdate:modelValue":l[5]||(l[5]=t=>u.value.options=t),placeholder:"defaults,nofail"},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(J,{modelValue:ee.value,"onUpdate:modelValue":l[9]||(l[9]=t=>ee.value=t),title:"Edit /etc/fstab",width:"800px","close-on-click-modal":!1},{default:s(()=>[g("div",ct,[a(ge,{type:"warning",closable:!1,style:{"margin-bottom":"15px"}},{default:s(()=>l[26]||(l[26]=[v(" Warning: Incorrect modifications may prevent your system from booting properly. ")])),_:1,__:[26]}),a(C,{modelValue:te.value,"onUpdate:modelValue":l[8]||(l[8]=t=>te.value=t),type:"textarea",rows:20,resize:"none",placeholder:"Loading fstab content...",loading:N.value},null,8,["modelValue","loading"]),g("div",pt,[a(o,{onClick:ce,loading:N.value},{default:s(()=>l[27]||(l[27]=[v(" Reload ")])),_:1,__:[27]},8,["loading"]),a(o,{type:"primary",onClick:De,loading:N.value},{default:s(()=>l[28]||(l[28]=[v(" Save ")])),_:1,__:[28]},8,["loading"])])])]),_:1},8,["modelValue"]),a(J,{modelValue:Y.value,"onUpdate:modelValue":l[14]||(l[14]=t=>Y.value=t),title:e.$t("storageFilesystems.raidDialog.title"),width:"600px"},{footer:s(()=>[a(o,{onClick:l[13]||(l[13]=t=>Y.value=!1)},{default:s(()=>[v(r(e.$t("common.cancel")),1)]),_:1}),a(o,{type:"primary",onClick:Ue},{default:s(()=>[v(r(e.$t("storageFilesystems.raidDialog.create")),1)]),_:1})]),default:s(()=>[a(se,{model:_.value,"label-position":"top"},{default:s(()=>[a(p,{label:e.$t("storageFilesystems.raidDialog.raidLevel")},{default:s(()=>[a(k,{modelValue:_.value.level,"onUpdate:modelValue":l[10]||(l[10]=t=>_.value.level=t),style:{width:"100%"}},{default:s(()=>[a(i,{label:"RAID 0 (Stripping)",value:"0"}),a(i,{label:"RAID 1 (Mirroring)",value:"1"}),a(i,{label:"RAID 5 (Parity)",value:"5"}),a(i,{label:"RAID 6 (Double Parity)",value:"6"}),a(i,{label:"RAID 10 (Striped Mirror)",value:"10"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(p,{label:e.$t("storageFilesystems.raidDialog.devices")},{default:s(()=>[a(k,{modelValue:_.value.devices,"onUpdate:modelValue":l[11]||(l[11]=t=>_.value.devices=t),multiple:"",style:{width:"100%"}},{default:s(()=>[(n(!0),V(S,null,E(ke.value,t=>(n(),f(i,{key:t.path,label:t.path,value:t.path,disabled:t.mountpoint},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(p,{label:e.$t("storageFilesystems.raidDialog.name")},{default:s(()=>[a(C,{modelValue:_.value.name,"onUpdate:modelValue":l[12]||(l[12]=t=>_.value.name=t),placeholder:"md0"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(J,{modelValue:O.value,"onUpdate:modelValue":l[21]||(l[21]=t=>O.value=t),title:e.$t("storageFilesystems.formatDialog.title"),width:"500px"},{footer:s(()=>[a(o,{onClick:l[20]||(l[20]=t=>O.value=!1)},{default:s(()=>[v(r(e.$t("common.cancel")),1)]),_:1}),a(o,{type:"danger",onClick:Ee,loading:ne.value},{default:s(()=>[v(r(e.$t("storageFilesystems.formatDialog.format")),1)]),_:1},8,["loading"])]),default:s(()=>[a(se,{model:c.value,"label-position":"top"},{default:s(()=>[a(p,{label:e.$t("storageFilesystems.formatDialog.device")},{default:s(()=>[a(k,{modelValue:c.value.device,"onUpdate:modelValue":l[15]||(l[15]=t=>c.value.device=t),placeholder:e.$t("storageFilesystems.formatDialog.selectDevice"),style:{width:"100%"}},{default:s(()=>[(n(!0),V(S,null,E(Ve.value,t=>(n(),f(i,{key:t.path,label:`${t.path} (${t.model||"Unknown"}) ${t.fstype?`[${t.fstype}]`:""}`,value:t.path},null,8,["label","value"]))),128)),(n(!0),V(S,null,E(me.value,t=>(n(),f(i,{key:t.path,label:`${t.path} (${t.model||"Unknown"})`,value:t.path},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("storageFilesystems.formatDialog.fsType")},{default:s(()=>[a(k,{modelValue:c.value.fsType,"onUpdate:modelValue":l[16]||(l[16]=t=>c.value.fsType=t),placeholder:e.$t("storageFilesystems.formatDialog.selectFsType"),style:{width:"100%"}},{default:s(()=>[(n(!0),V(S,null,E(de.value,t=>(n(),f(i,{key:t,label:t,value:t.toLowerCase()},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),c.value.fsType==="zfs"?(n(),f(p,{key:0,label:e.$t("storageFilesystems.formatDialog.zfsPoolName")},{default:s(()=>[a(C,{modelValue:c.value.zfsPoolName,"onUpdate:modelValue":l[17]||(l[17]=t=>c.value.zfsPoolName=t),placeholder:"mypool"},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0),c.value.fsType==="zfs"?(n(),f(p,{key:1,label:"Urządzenie (automatycznie wybrano cały dysk)"},{default:s(()=>[a(C,{value:c.value.device.replace(/[0-9]+$/,""),disabled:""},null,8,["value"]),l[29]||(l[29]=g("div",{class:"el-form-item__description"}," ZFS wymaga całego dysku (np. /dev/sda zamiast /dev/sda1) ",-1))]),_:1,__:[29]})):(n(),f(p,{key:2,label:e.$t("storageFilesystems.formatDialog.label")},{default:s(()=>[a(C,{modelValue:c.value.label,"onUpdate:modelValue":l[18]||(l[18]=t=>c.value.label=t),placeholder:`${c.value.fsType.toUpperCase()}_VOLUME`},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),a(p,{label:e.$t("storageFilesystems.formatDialog.force")},{default:s(()=>[a(ye,{modelValue:c.value.force,"onUpdate:modelValue":l[19]||(l[19]=t=>c.value.force=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),c.value.device?(n(),V("div",ft,[a(ge,{type:"warning",closable:!1},{default:s(()=>[v(r(e.$t("storageFilesystems.formatDialog.warning",{device:c.value.device})),1)]),_:1})])):D("",!0)]),_:1},8,["modelValue","title"]),nt((n(),f(Je,{data:R.value,style:{width:"100%"}},{default:s(()=>[a(P,{label:e.$t("storageFilesystems.device"),prop:"device",width:"120"},{default:s(({row:t})=>[g("div",vt,[a(F($),{icon:Be(t.device),width:"18",height:"18"},null,8,["icon"]),g("span",null,[v(r(t.device)+" ",1),t.device.includes("/dev/md")?(n(),f(X,{key:0,size:"mini",type:"warning"},{default:s(()=>[v(r(e.$t("storageFilesystems.raidArray")),1)]),_:1})):D("",!0)])])]),_:1},8,["label"]),a(P,{label:e.$t("storageFilesystems.tags"),prop:"tags",width:"100"},{default:s(({row:t})=>[t.tags?(n(),f(X,{key:0,size:"small"},{default:s(()=>[v(r(t.tags),1)]),_:2},1024)):D("",!0)]),_:1},8,["label"]),a(P,{label:e.$t("storageFilesystems.type"),prop:"type",width:"100"},{default:s(({row:t})=>[a(F($),{icon:Le(t.type),width:"16",height:"16"},null,8,["icon"]),g("span",null,r(t.type),1)]),_:1},8,["label"]),a(P,{label:e.$t("storageFilesystems.available"),prop:"available",width:"120"},{default:s(({row:t})=>[g("div",gt,[a(F($),{icon:"mdi:harddisk-plus",width:"16",height:"16"}),g("span",null,r(H(t.available)),1)])]),_:1},8,["label"]),a(P,{label:e.$t("storageFilesystems.used"),prop:"used",width:"400"},{default:s(({row:t})=>[a(be,{percentage:t.usedPercent,color:fe(t.usedPercent),"show-text":!1,"stroke-width":14},null,8,["percentage","color"]),g("span",null,r(H(t.used))+" ("+r(t.usedPercent)+"%)",1)]),_:1},8,["label"]),a(P,{label:e.$t("storageFilesystems.mounted"),prop:"mounted"},{default:s(({row:t})=>[g("div",yt,[a(F($),{icon:"mdi:folder-marker",width:"16",height:"16"}),g("span",null,r(t.mounted),1)])]),_:1},8,["label"]),a(P,{label:"Auto-mount",width:"120"},{default:s(({row:t})=>[t.isZfs?(n(),f(X,{key:1,type:"info",size:"small"},{default:s(()=>l[30]||(l[30]=[v("ZFS")])),_:1,__:[30]})):(n(),f(ye,{key:0,modelValue:t.inFstab,"onUpdate:modelValue":I=>t.inFstab=I,onChange:I=>pe(t.device,t.mounted,t.type,t.options,I),loading:t.fstabLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"]))]),_:1}),a(P,{label:e.$t("storageFilesystems.reference"),prop:"reference",width:"120"},{default:s(({row:t})=>[t.reference?(n(),f(X,{key:0,size:"small",type:"info"},{default:s(()=>[v(r(t.reference),1)]),_:2},1024)):D("",!0)]),_:1},8,["label"]),a(P,{label:e.$t("storageFilesystems.status"),prop:"status",width:"120"},{default:s(({row:t})=>[a(X,{type:Ae(t.status),size:"small"},{default:s(()=>[a(F($),{icon:Ne(t.status),width:"14",height:"14"},null,8,["icon"]),g("span",null,[v(r(t.status)+" ",1),t.readOnly?(n(),V("span",bt,"(RO)")):D("",!0)])]),_:2},1032,["type"])]),_:1},8,["label"]),a(P,{label:e.$t("storageFilesystems.actions"),width:"150"},{default:s(({row:t})=>[a(o,{size:"small",onClick:I=>Me(t.mounted),disabled:t.status!=="active",text:""},{default:s(()=>[a(F($),{icon:"mdi:eject",width:"16",height:"16"}),v(" "+r(e.$t("storageFilesystems.unmount")),1)]),_:2},1032,["onClick","disabled"])]),_:1},8,["label"])]),_:1},8,["data"])),[[tt,b.value]]),U.value?(n(),V("div",ht,[a(F($),{icon:"mdi:alert-circle",width:"18",height:"18"}),g("span",null,r(U.value),1)])):D("",!0)]),_:1}),a(J,{modelValue:Q.value,"onUpdate:modelValue":l[25]||(l[25]=t=>Q.value=t),title:e.$t("storageFilesystems.partitionDialog.title"),width:"700px"},{footer:s(()=>[a(o,{onClick:l[24]||(l[24]=t=>Q.value=!1)},{default:s(()=>[v(r(e.$t("common.cancel")),1)]),_:1}),a(o,{type:"primary",onClick:We,loading:ue.value,disabled:y.value.partitions.length===0},{default:s(()=>[v(r(e.$t("storageFilesystems.partitionDialog.create")),1)]),_:1},8,["loading","disabled"])]),default:s(()=>[a(se,{model:y.value,"label-position":"top"},{default:s(()=>[a(p,{label:e.$t("storageFilesystems.partitionDialog.device")},{default:s(()=>[a(k,{modelValue:y.value.device,"onUpdate:modelValue":l[22]||(l[22]=t=>y.value.device=t),placeholder:e.$t("storageFilesystems.partitionDialog.selectDevice"),style:{width:"100%"},onChange:je},{default:s(()=>[(n(!0),V(S,null,E(Ie.value,t=>(n(),f(i,{key:t.path,label:`${t.path} (${t.model||"Unknown"})`,value:t.path,disabled:q(t.path)},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),y.value.device?(n(),f(p,{key:0,label:e.$t("storageFilesystems.partitionDialog.diskSize")},{default:s(()=>[g("div",wt,[a(be,{percentage:K.value,color:fe(K.value),"show-text":!1,"stroke-width":20},null,8,["percentage","color"]),g("div",kt,[g("span",null,r(H(le.value))+" / "+r(H(w.value)),1),g("span",null,"("+r(K.value)+"%)",1)])])]),_:1},8,["label"])):D("",!0),a(p,{label:e.$t("storageFilesystems.partitionDialog.scheme")},{default:s(()=>[a(xe,{modelValue:y.value.scheme,"onUpdate:modelValue":l[23]||(l[23]=t=>y.value.scheme=t)},{default:s(()=>[a(he,{value:"gpt"},{default:s(()=>l[31]||(l[31]=[v("GPT")])),_:1,__:[31]}),a(he,{value:"mbr"},{default:s(()=>l[32]||(l[32]=[v("MBR")])),_:1,__:[32]})]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(p,{label:e.$t("storageFilesystems.partitionDialog.partitions")},{default:s(()=>[g("div",zt,[(n(!0),V(S,null,E(y.value.partitions,(t,I)=>(n(),V("div",{key:I,class:"partition-item"},[a(et,{modelValue:t.size,"onUpdate:modelValue":B=>t.size=B,min:1,max:Ye(t),step:t.unit==="%"?1:t.unit==="G"?10:100,precision:0},null,8,["modelValue","onUpdate:modelValue","max","step"]),a(k,{modelValue:t.unit,"onUpdate:modelValue":B=>t.unit=B,style:{width:"100px","margin-left":"10px"},onChange:B=>He(t,B)},{default:s(()=>[a(i,{label:"MB",value:"M"}),a(i,{label:"GB",value:"G"}),a(i,{label:"%",value:"%"})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),a(k,{modelValue:t.type,"onUpdate:modelValue":B=>t.type=B,style:{width:"150px","margin-left":"10px"}},{default:s(()=>[a(i,{label:"Linux",value:"8300"}),a(i,{label:"Linux swap",value:"8200"}),a(i,{label:"EFI System",value:"EF00"}),a(i,{label:"Microsoft basic data",value:"0700"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),a(o,{onClick:B=>Ze(I),type:"danger",size:"small"},{default:s(()=>[a(F($),{icon:"mdi:delete"})]),_:2},1032,["onClick"]),g("span",Ft,r(Ke(t)),1)]))),128))]),a(o,{onClick:Re,type:"primary",size:"small"},{default:s(()=>[v(r(e.$t("storageFilesystems.partitionDialog.addPartition")),1)]),_:1})]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}}),Ct=lt(Vt,[["__scopeId","data-v-da5cb5da"]]);export{Ct as default};
