import{_ as N,u as x,r as d,o as C,K as E,b as M,v as q,x as B,h as j,e as m,w as k,f as e,d as p,i as w,t as a,k as s,g as r,m as g,I as l,p as L,E as P}from"./index-JqcLm-KS.js";const V={class:"widget-header"},U={class:"header-main"},O={class:"update-time"},W={class:"header-sub"},F={class:"hostname"},H={class:"system"},K={class:"widget-content"},z={class:"info-row"},A={class:"label"},G={class:"value"},J={class:"info-row"},Q={class:"label"},X={class:"value"},Y={class:"info-row"},Z={class:"label"},ee={class:"value"},te={class:"info-row"},se={class:"label"},oe={class:"value"},ae={key:0,class:"info-row restart-row"},ne={class:"label"},ie={class:"value"},re={class:"restart-dialog"},le={class:"dialog-header"},ce={class:"dialog-body"},de={class:"dialog-footer"},me={key:1,class:"restart-overlay"},ue={class:"restart-message"},he={class:"spinner"},_e={name:"SystemInfoWidget",displayName:"Informacje o systemie"},fe=Object.assign(_e,{setup(ve){const{t}=x(),i=d({system:{hostname:"",distro:"",kernel:"",time:"",uptime:0,requiresRestart:!1},cpu:{model:""}}),u=d(t("common.loading")),c=d(!1),h=d(!1);let I=null,_=null;const f=d(!0),R=o=>{try{return new Date(o).toLocaleString("pl-PL",{weekday:"short",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return t("common.error")}},S=o=>{if(!o)return"00d 00h 00m";const n=Math.floor(o/86400),v=Math.floor(o%86400/3600),y=Math.floor(o%3600/60);return`${n}${t("common.daysShort")} ${v}${t("common.hoursShort")} ${y}${t("common.minutesShort")}`},b=async()=>{try{f.value=!0;const o=await fetch(`${window.location.protocol}//${window.location.hostname}:3000/api/system-info`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const n=await o.json();n&&(i.value=n,u.value=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))}catch(o){u.value=t("common.error"),console.error("Error fetching system info:",o)}finally{f.value=!1,i.value.system.requiresRestart&&!localStorage.getItem("rebootReminder")&&setTimeout(()=>{c.value=!0},1e3)}},D=async()=>{c.value=!1,h.value=!0;try{if(!(await fetch(`${window.location.protocol}//${window.location.hostname}:3000/api/system-restart`,{method:"POST"})).ok)throw new Error("Restart failed");_=setTimeout(()=>{window.location.reload()},1e5);const n=async()=>{try{await fetch(`${window.location.protocol}//${window.location.hostname}:3000/api/system-health`),window.location.reload()}catch{setTimeout(n,1e3)}};setTimeout(n,5e3)}catch(o){console.error("Restart error:",o),h.value=!1,P.error({title:t("common.error"),message:t("systemInfo.restartFailed"),duration:5e3})}},T=()=>{const o=new Date(Date.now()+432e5);localStorage.setItem("rebootReminder",o),c.value=!1},$=()=>{const o=localStorage.getItem("rebootReminder");if(o){const n=new Date(o);new Date>n&&localStorage.removeItem("rebootReminder")}};return C(()=>{$(),b(),I=setInterval(b,3e4)}),E(()=>{clearInterval(I),_&&clearTimeout(_)}),(o,n)=>{const v=M("el-card"),y=q("loading");return B((m(),j(v,{class:"widget-card",shadow:"hover"},{header:k(()=>[e("div",V,[e("div",U,[r(s(l),{icon:"mdi:information-outline",width:"18"}),n[1]||(n[1]=e("span",{class:"header-title"},"Informacje o systemie",-1)),e("div",O,[r(s(l),{icon:"mdi:update",width:"14"}),e("span",null,a(s(t)("common.update"))+": "+a(u.value),1)])]),e("div",W,[e("span",F,a(i.value.system.hostname||s(t)("common.loading")),1),e("span",H,a(i.value.system.distro||s(t)("common.loading")),1)])])]),default:k(()=>[e("div",K,[e("div",z,[e("span",A,a(s(t)("systemInfo.cpu")),1),e("span",G,a(i.value.cpu.manufacturer+" "+i.value.cpu.brand||s(t)("common.loading")),1)]),e("div",J,[e("span",Q,a(s(t)("systemInfo.system")),1),e("span",X,a(i.value.system.kernel||s(t)("common.loading")),1)]),e("div",Y,[e("span",Z,a(s(t)("systemInfo.systemTime")),1),e("span",ee,a(i.value.system.time?R(i.value.system.time):s(t)("common.loading")),1)]),e("div",te,[e("span",se,a(s(t)("systemInfo.uptime")),1),e("span",oe,a(i.value.system.uptime?S(i.value.system.uptime):s(t)("common.loading")),1)]),i.value.system.requiresRestart?(m(),p("div",ae,[e("span",ne,[r(s(l),{icon:"mdi:alert-circle",width:"14"}),g(" "+a(s(t)("systemInfo.status"))+": ",1)]),e("span",ie,a(s(t)("systemInfo.restartRequired")),1)])):w("",!0)]),c.value?(m(),p("div",{key:0,class:"restart-dialog-overlay",onClick:n[0]||(n[0]=L(ye=>c.value=!1,["self"]))},[e("div",re,[e("div",le,[r(s(l),{icon:"mdi:alert-circle",width:"24"}),e("h3",null,a(s(t)("systemInfo.restartRequired")),1)]),e("div",ce,[e("p",null,a(s(t)("systemInfo.restartDialogMessage")),1)]),e("div",de,[e("button",{class:"btn later",onClick:T},[r(s(l),{icon:"mdi:clock-outline",width:"16"}),g(" "+a(s(t)("systemInfo.restartLater")),1)]),e("button",{class:"btn now",onClick:D},[r(s(l),{icon:"mdi:restart",width:"16"}),g(" "+a(s(t)("systemInfo.restartNow")),1)])])])])):w("",!0),h.value?(m(),p("div",me,[e("div",ue,[e("div",he,[r(s(l),{icon:"mdi:restart",width:"48",class:"spinning"})]),e("h3",null,a(s(t)("systemInfo.restartInProgress")),1),e("p",null,a(s(t)("systemInfo.restartDescription")),1)])])):w("",!0)]),_:1})),[[y,f.value]])}}}),we=N(fe,[["__scopeId","data-v-aea3c375"]]);export{we as default};
