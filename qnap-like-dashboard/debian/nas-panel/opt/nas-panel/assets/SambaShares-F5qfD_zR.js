import{_ as K,r as i,o as Q,y as p,z as r,b as o,v as W,d as x,e as f,h as j,w as l,f as b,g as a,m as d,F as X,i as $,x as Y,t as D,k as S,I as h,n as ee,B as ae}from"./index-JqcLm-KS.js";const le={class:"samba-shares-container"},te={class:"card-header"},ne={key:0,class:"disabled-overlay"},oe={class:"action-buttons"},se={__name:"SambaShares",setup(ie){const w=i(!0),V=i(!1),N=i([]),c=i(!1),B=i(!1);i(null);const T=i(!0),m=i(!1),v=i(null),C=i(!1),s=i({name:"",path:"",comment:"",readOnly:!1});Q(()=>{A(),(c.value=!0)&&z()});async function A(){try{const n=await p.get("/services/samba/status");w.value=n.data.installed,c.value=n.data.running,c.value||r.warning("Usługa Samba jest wyłączona. Udostępnienia są niedostępne.")}catch{r.error("Błąd sprawdzania stanu Samby"),w.value=!1,c.value=!1}}async function E(){V.value=!0;try{await p.post("/services/samba/install"),r.success("Samba zainstalowana pomyślnie"),w.value=!0,z()}catch{r.error("Błąd instalacji Samby")}finally{V.value=!1}}async function z(){B.value=!0;try{const n=await p.get("/services/samba/shares");N.value=n.data.data||[]}catch{r.error("Błąd ładowania udostępnień")}finally{B.value=!1}}function I(n){v.value=n,s.value={...n},m.value=!0}async function F(){C.value=!0;try{v.value?(await p.put(`/services/samba/shares/${v.value.name}`,s.value),r.success("Udostępnienie zaktualizowane")):(await p.post("/services/samba/shares",s.value),r.success("Udostępnienie utworzone")),m.value=!1,z()}catch(n){r.error(n.response?.data?.error||"Błąd podczas zapisywania")}finally{C.value=!1}}async function M(n){try{await ae.confirm(`Czy na pewno chcesz usunąć udostępnienie "${n.name}"?`,"Potwierdzenie usunięcia",{confirmButtonText:"Usuń",cancelButtonText:"Anuluj",type:"warning",beforeClose:async(e,u,_)=>{if(e==="confirm"){u.confirmButtonLoading=!0;try{await p.delete(`/services/samba/shares/${encodeURIComponent(n.name)}`),r.success("Udostępnienie zostało usunięte"),await z(),_()}catch(g){r.error(g.response?.data?.error||"Błąd podczas usuwania"),u.confirmButtonLoading=!1}}else _()}})}catch(e){e!=="cancel"&&console.error("Delete error:",e)}}return(n,e)=>{const u=o("el-button"),_=o("el-alert"),g=o("el-icon"),O=o("el-tag"),q=o("router-link"),y=o("el-table-column"),L=o("el-table"),R=o("el-card"),U=o("el-input"),k=o("el-form-item"),Z=o("el-switch"),P=o("el-form"),G=o("el-dialog"),H=W("loading");return f(),x("div",le,[w.value?(f(),x(X,{key:1},[a(R,{class:ee({"disabled-card":!c.value})},{header:l(()=>[b("div",te,[b("h2",null,[a(g,null,{default:l(()=>[a(S(h),{icon:"mdi:folder-network"})]),_:1}),e[10]||(e[10]=d(" Udostępnienia Samba ")),c.value?$("",!0):(f(),j(O,{key:0,type:"danger",effect:"dark",class:"status-tag"},{default:l(()=>e[9]||(e[9]=[d(" Samba wyłączona ")])),_:1,__:[9]}))]),a(u,{type:"primary",onClick:e[0]||(e[0]=t=>m.value=!0),disabled:!T.value},{default:l(()=>[a(g,null,{default:l(()=>[a(S(h),{icon:"mdi:plus"})]),_:1}),e[11]||(e[11]=d(" Nowe udostępnienie "))]),_:1,__:[11]},8,["disabled"])])]),default:l(()=>[c.value?$("",!0):(f(),x("div",ne,[a(_,{title:"Usługa Samba jest wyłączona",type:"error",closable:!1,center:"","show-icon":""},{default:l(()=>[b("p",null,[e[13]||(e[13]=d("Aby zarządzać udostępnieniami, włącz usługę Samba w zakładce ")),a(q,{to:"/services/samba/status"},{default:l(()=>e[12]||(e[12]=[d("Status usługi")])),_:1,__:[12]})])]),_:1})])),Y((f(),j(L,{data:N.value,"empty-text":"Brak udostępnień",style:{width:"100%"}},{default:l(()=>[a(y,{prop:"name",label:"Nazwa",width:"180"}),a(y,{prop:"path",label:"Ścieżka"}),a(y,{prop:"comment",label:"Opis"}),a(y,{label:"Tylko do odczytu",width:"120"},{default:l(({row:t})=>[a(O,{type:t.readOnly?"danger":"success"},{default:l(()=>[d(D(t.readOnly?"Tak":"Nie"),1)]),_:2},1032,["type"])]),_:1}),a(y,{label:"Operacje",width:"150"},{default:l(({row:t})=>[b("div",oe,[a(u,{size:"small",circle:"",onClick:J=>I(t),icon:"Edit",class:"action-button",link:""},{default:l(()=>[a(S(h),{icon:"mdi:edit",width:"16"})]),_:2},1032,["onClick"]),a(u,{size:"small",circle:"",type:"danger",onClick:J=>M(t),icon:"Delete",class:"action-button",link:""},{default:l(()=>[a(S(h),{icon:"mdi:delete",width:"16"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[H,B.value]])]),_:1},8,["class"]),a(G,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=t=>m.value=t),title:v.value?"Edytuj udostępnienie":"Nowe udostępnienie",width:"50%"},{footer:l(()=>[a(u,{onClick:e[5]||(e[5]=t=>m.value=!1)},{default:l(()=>e[14]||(e[14]=[d("Anuluj")])),_:1,__:[14]}),a(u,{type:"primary",onClick:F,loading:C.value},{default:l(()=>[d(D(v.value?"Zapisz zmiany":"Utwórz udostępnienie"),1)]),_:1},8,["loading"])]),default:l(()=>[a(P,{model:s.value,"label-width":"150px"},{default:l(()=>[a(k,{label:"Nazwa udostępnienia",required:""},{default:l(()=>[a(U,{modelValue:s.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.name=t)},null,8,["modelValue"])]),_:1}),a(k,{label:"Ścieżka na serwerze",required:""},{default:l(()=>[a(U,{modelValue:s.value.path,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.path=t),placeholder:"/ścieżka/do/folderu"},null,8,["modelValue"])]),_:1}),a(k,{label:"Opis"},{default:l(()=>[a(U,{modelValue:s.value.comment,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.comment=t)},null,8,["modelValue"])]),_:1}),a(k,{label:"Tylko do odczytu"},{default:l(()=>[a(Z,{modelValue:s.value.readOnly,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.readOnly=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)):(f(),j(_,{key:0,title:"Samba nie jest zainstalowane",type:"error",closable:!1,"show-icon":""},{default:l(()=>[e[8]||(e[8]=b("p",null,"Aby korzystać z funkcji Samba, zainstaluj pakiet na serwerze:",-1)),a(u,{type:"primary",onClick:E,loading:V.value},{default:l(()=>e[7]||(e[7]=[d(" Zainstaluj Sambę ")])),_:1,__:[7]},8,["loading"])]),_:1}))])}}},ue=K(se,[["__scopeId","data-v-814fc8d7"]]);export{ue as default};
