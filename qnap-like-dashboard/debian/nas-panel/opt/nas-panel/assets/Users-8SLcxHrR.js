import{_ as Y,u as Z,r as c,o as x,b as u,v as ee,d as V,e as i,g as s,w as a,x as le,h as w,m as d,t,f as y,F as C,l as S,i as q,y as U,z as _,B as ae}from"./index-JqcLm-KS.js";const se={class:"users-container"},oe={class:"card-header"},te={class:"groups-container"},ne={style:{float:"left"}},re={style:{float:"right",color:"#8492a6","font-size":"13px"}},ue={style:{float:"left"}},de={style:{float:"right",color:"#8492a6","font-size":"13px"}},ie={__name:"Users",setup(me){const{t:m}=Z(),G=c([]),B=c([]),z=c(!1),k=c({currentPage:1,pageSize:10,total:0}),g=c(!1),b=c(!1),E=c(null),n=c({username:"",password:"",isAdmin:!1,selectedGroups:[]}),r=c({username:"",password:"",isAdmin:!1,selectedGroups:[]}),h=async()=>{try{z.value=!0;const[e,o]=await Promise.all([U.get("/api/system/users"),U.get("/api/system/groups")]);G.value=e.data.map(p=>({...p,isAdmin:p.groups.includes("root")})),B.value=o.data,k.value.total=G.value.length}catch(e){console.error("Błąd pobierania danych:",e),_.error(m("users.errors.fetchData"))}finally{z.value=!1}},R=()=>{n.value={username:"",password:"",isAdmin:!1,selectedGroups:[]},g.value=!0},j=e=>{E.value=e,r.value={username:e.username,password:"",isAdmin:e.groups.includes("root"),selectedGroups:e.groups.filter(o=>o!==e.username&&o!=="root")},b.value=!0},L=async e=>{try{await ae.confirm(m("users.deleteConfirm",{username:e.username}),m("common.confirmation"),{confirmButtonText:m("common.yes"),cancelButtonText:m("common.cancel"),type:"warning"}),await U.delete(`/api/system/users/${e.username}`),_.success(m("users.deleteSuccess")),h()}catch(o){o!=="cancel"&&(console.error("Błąd usuwania użytkownika:",o),_.error(m("users.errors.delete")))}},H=async()=>{try{const e={username:n.value.username,password:n.value.password,isAdmin:n.value.isAdmin,groups:n.value.selectedGroups};await U.post("/api/system/users",e),_.success(m("users.addSuccess")),g.value=!1,h()}catch(e){console.error("Błąd dodawania użytkownika:",e),_.error(e.response?.data?.error||m("users.errors.add"))}},J=async()=>{try{const e={password:r.value.password||void 0,isAdmin:r.value.isAdmin,groups:r.value.selectedGroups};await U.put(`/api/system/users/${E.value.username}`,e),_.success(m("users.updateSuccess")),b.value=!1,h()}catch(e){console.error("Błąd aktualizacji użytkownika:",e),_.error(e.response?.data?.error||m("users.errors.update"))}},K=e=>{k.value.currentPage=e};return x(h),(e,o)=>{const p=u("el-button"),$=u("el-table-column"),A=u("el-tag"),O=u("el-table"),Q=u("el-pagination"),W=u("el-card"),D=u("el-input"),f=u("el-form-item"),I=u("el-switch"),N=u("el-text"),P=u("el-option"),F=u("el-select"),M=u("el-form"),T=u("el-dialog"),X=ee("loading");return i(),V("div",se,[s(W,{class:"box-card"},{header:a(()=>[y("div",oe,[y("span",null,t(e.$t("users.management")),1),s(p,{type:"primary",onClick:R},{default:a(()=>[d(t(e.$t("users.addUser")),1)]),_:1})])]),default:a(()=>[le((i(),w(O,{data:G.value,border:"",style:{width:"100%"}},{default:a(()=>[s($,{prop:"username",label:e.$t("users.username")},null,8,["label"]),s($,{prop:"id",label:"UID",width:"100"}),s($,{label:e.$t("users.isAdmin"),width:"120"},{default:a(l=>[s(A,{type:l.row.isAdmin?"danger":"info"},{default:a(()=>[d(t(l.row.isAdmin?e.$t("common.yes"):e.$t("common.no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),s($,{label:e.$t("users.groups"),"min-width":"200"},{default:a(l=>[y("div",te,[(i(!0),V(C,null,S(l.row.groups,v=>(i(),V(C,{key:v},[v===l.row.username?(i(),w(A,{key:0,class:"group-tag"},{default:a(()=>[d(t(v),1)]),_:2},1024)):v==="root"?(i(),w(A,{key:1,type:"danger",class:"group-tag"},{default:a(()=>[d(t(v),1)]),_:2},1024)):(i(),w(A,{key:2,type:"info",class:"group-tag"},{default:a(()=>[d(t(v),1)]),_:2},1024))],64))),128))])]),_:1},8,["label"]),s($,{label:e.$t("common.actions"),width:"180"},{default:a(l=>[s(p,{size:"small",onClick:v=>j(l.row)},{default:a(()=>[d(t(e.$t("common.edit")),1)]),_:2},1032,["onClick"]),s(p,{size:"small",type:"danger",onClick:v=>L(l.row),disabled:l.row.username==="root"},{default:a(()=>[d(t(e.$t("common.delete")),1)]),_:2},1032,["onClick","disabled"])]),_:1},8,["label"])]),_:1},8,["data"])),[[X,z.value]]),s(Q,{class:"pagination","page-size":k.value.pageSize,total:k.value.total,onCurrentChange:K},null,8,["page-size","total"])]),_:1}),s(T,{modelValue:g.value,"onUpdate:modelValue":o[5]||(o[5]=l=>g.value=l),title:e.$t("users.addUserDialog.title"),width:"600px"},{footer:a(()=>[s(p,{onClick:o[4]||(o[4]=l=>g.value=!1)},{default:a(()=>[d(t(e.$t("common.cancel")),1)]),_:1}),s(p,{type:"primary",onClick:H,disabled:!n.value.username||!n.value.password},{default:a(()=>[d(t(e.$t("users.addUser")),1)]),_:1},8,["disabled"])]),default:a(()=>[s(M,{model:n.value,"label-width":"160px"},{default:a(()=>[s(f,{label:e.$t("users.username"),required:""},{default:a(()=>[s(D,{modelValue:n.value.username,"onUpdate:modelValue":o[0]||(o[0]=l=>n.value.username=l)},null,8,["modelValue"])]),_:1},8,["label"]),s(f,{label:e.$t("users.password"),required:""},{default:a(()=>[s(D,{modelValue:n.value.password,"onUpdate:modelValue":o[1]||(o[1]=l=>n.value.password=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),s(f,{label:e.$t("users.isAdmin")},{default:a(()=>[s(I,{modelValue:n.value.isAdmin,"onUpdate:modelValue":o[2]||(o[2]=l=>n.value.isAdmin=l)},null,8,["modelValue"]),n.value.isAdmin?(i(),w(N,{key:0,type:"info"},{default:a(()=>[d(t(e.$t("users.addUserDialog.adminNote")),1)]),_:1})):q("",!0)]),_:1},8,["label"]),s(f,{label:e.$t("users.additionalGroups")},{default:a(()=>[s(F,{modelValue:n.value.selectedGroups,"onUpdate:modelValue":o[3]||(o[3]=l=>n.value.selectedGroups=l),multiple:"",filterable:"",style:{width:"100%"},placeholder:e.$t("users.selectGroups")},{default:a(()=>[(i(!0),V(C,null,S(B.value.filter(l=>l.name!=="root"),l=>(i(),w(P,{key:l.name,label:l.name,value:l.name},{default:a(()=>[y("span",ne,t(l.name),1),y("span",re," (GID: "+t(l.gid)+") ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),s(T,{modelValue:b.value,"onUpdate:modelValue":o[11]||(o[11]=l=>b.value=l),title:e.$t("users.editUserDialog.title"),width:"600px"},{footer:a(()=>[s(p,{onClick:o[10]||(o[10]=l=>b.value=!1)},{default:a(()=>[d(t(e.$t("common.cancel")),1)]),_:1}),s(p,{type:"primary",onClick:J},{default:a(()=>[d(t(e.$t("common.saveChanges")),1)]),_:1})]),default:a(()=>[s(M,{model:r.value,"label-width":"160px"},{default:a(()=>[s(f,{label:e.$t("users.username")},{default:a(()=>[s(D,{modelValue:r.value.username,"onUpdate:modelValue":o[6]||(o[6]=l=>r.value.username=l),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),s(f,{label:e.$t("users.newPassword")},{default:a(()=>[s(D,{modelValue:r.value.password,"onUpdate:modelValue":o[7]||(o[7]=l=>r.value.password=l),type:"password","show-password":""},null,8,["modelValue"]),s(N,{type:"info"},{default:a(()=>[d(t(e.$t("users.editUserDialog.passwordNote")),1)]),_:1})]),_:1},8,["label"]),s(f,{label:e.$t("users.isAdmin")},{default:a(()=>[s(I,{modelValue:r.value.isAdmin,"onUpdate:modelValue":o[8]||(o[8]=l=>r.value.isAdmin=l)},null,8,["modelValue"]),r.value.isAdmin?(i(),w(N,{key:0,type:"info"},{default:a(()=>[d(t(e.$t("users.editUserDialog.adminNote")),1)]),_:1})):q("",!0)]),_:1},8,["label"]),s(f,{label:e.$t("users.additionalGroups")},{default:a(()=>[s(F,{modelValue:r.value.selectedGroups,"onUpdate:modelValue":o[9]||(o[9]=l=>r.value.selectedGroups=l),multiple:"",filterable:"",style:{width:"100%"},placeholder:e.$t("users.selectGroups")},{default:a(()=>[(i(!0),V(C,null,S(B.value.filter(l=>l.name!=="root"),l=>(i(),w(P,{key:l.name,label:l.name,value:l.name},{default:a(()=>[y("span",ue,t(l.name),1),y("span",de," (GID: "+t(l.gid)+") ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ce=Y(ie,[["__scopeId","data-v-9d92de54"]]);export{ce as default};
