import{_ as Ae,u as Be,r as p,c as pe,y as b,o as Me,K as He,b as c,h as N,e as h,w as a,g as t,i as P,m as o,t as i,f as w,d as C,k as v,I as m,N as Ke,F as ee,l as te,n as je,E as _e,z as Ge}from"./index-JqcLm-KS.js";const Qe={class:"card-header"},We={class:"scan-options"},Xe={key:0,class:"custom-scan-paths"},Ye={class:"path-list"},Ze={key:0,class:"scan-progress"},xe={class:"scan-stats"},et={class:"event-stream"},tt={class:"event-time"},at={key:0,class:"threats-detected"},nt={class:"history-filters"},lt={class:"history-item-header"},st={__name:"Antivirus",setup(it){const{t:r,locale:rt}=Be(),ae=p("scanner"),S=p("quick"),J=p(""),U=p([]),$=p(!1),R=p(0),E=p(0),B=p("0:00"),q=p([]),y=p([]),I=p(null),O=p({}),M=p(null),z=p(null),A=p("loading"),L=p("all"),H=p([]),_=p(null),f=p({autoUpdate:!0,updateFrequency:"daily",realtimeProtection:!0,notifications:!0}),fe={info:"mdi:information",warning:"mdi:alert",danger:"mdi:alert-octagon",success:"mdi:check-circle"},K=p(!1),j=p(!1),he=pe(()=>{switch(A.value){case"active":return r("antivirus.status_active");case"error":return r("antivirus.status_error");case"disabled":return r("antivirus.status_disabled");default:return r("antivirus.status_loading")}}),ye=pe(()=>{const e=new Date;return H.value.filter(l=>{if(L.value==="all")return!0;if(L.value==="week"){const n=new Date(l.timestamp);return e-n<=7*24*60*60*1e3}if(L.value==="month"){const n=new Date(l.timestamp);return e-n<=30*24*60*60*1e3}return L.value==="threats"?l.threatsDetected>0:!0})}),ne=b.create({baseURL:`${window.location.protocol}//${window.location.hostname}:3000`,timeout:3e4});function ge(e){return e==="error"?"danger":e==="disabled"?"warning":"success"}const u=(e,l)=>{const n=new Date().toLocaleTimeString();q.value.unshift({type:e,message:l,time:n}),q.value.length>100&&q.value.pop(),e==="danger"&&_e.error({title:r("antivirus.threat_detected"),message:l,position:"bottom-right"})};function le(){const e=J.value.trim();e&&!U.value.includes(e)?(U.value.push(e),J.value=""):U.value.includes(e)&&u("warning",r("antivirus.path_already_added"))}function be(e){U.value.splice(e,1)}async function se(){try{const e=await b.get("/api/antivirus/status");O.value=e.data,A.value=e.data.installed?"active":"disabled",e.data.lastUpdate&&(z.value=new Date(e.data.lastUpdate).toLocaleString())}catch{A.value="error",u("error",r("antivirus.package_status_error"))}}async function $e(){try{const e=await b.get("/api/antivirus/virusdb");M.value=e.data.version,z.value=new Date(e.data.updatedAt).toLocaleString()}catch{u("warning",r("antivirus.virus_db_error"))}}async function we(){if($.value)return;$.value=!0,R.value=0,E.value=0,q.value=[],y.value=[];const e=new Date,l={scanType:S.value,paths:S.value==="custom"?U.value:[]};try{_.value&&_.value.close(),_.value=new EventSource(`${ne.defaults.baseURL}/api/antivirus/scan?${new URLSearchParams({scanType:l.scanType,paths:JSON.stringify(l.paths)})}`),_.value.onmessage=n=>{const d=JSON.parse(n.data);ke(d,e)},_.value.onerror=n=>{u("error",r("antivirus.scanner_connection_error")),$.value=!1,_.value&&_.value.close()},_.value.addEventListener("status",n=>{const d=JSON.parse(n.data);u("info",d.message)}),_.value.addEventListener("progress",n=>{const d=JSON.parse(n.data);R.value=d.progress,E.value=d.itemsScanned;const D=Math.floor((new Date-e)/1e3);B.value=oe(D),u("info",r("antivirus.scan_progress",{progress:d.progress,items:d.itemsScanned}))}),_.value.addEventListener("threat",n=>{const d=JSON.parse(n.data);y.value.push(d),u("danger",r("antivirus.threat_detected_message",{name:d.name})),_e.warning({title:r("antivirus.threat_detected_warning"),message:r("antivirus.threat_detected_path",{name:d.name,path:d.path}),position:"bottom-right",duration:0})}),_.value.addEventListener("complete",n=>{const d=JSON.parse(n.data);$.value=!1,u("success",r("antivirus.scan_complete")),I.value={scanType:S.value,timestamp:new Date().toISOString(),duration:B.value,itemsScanned:E.value,threatsDetected:y.value.length,threats:y.value},ie(I.value),_.value&&_.value.close()})}catch{u("error",r("antivirus.scan_start_error")),$.value=!1,_.value&&_.value.close()}}function ke(e,l){R.value=e.progress,E.value=e.itemsScanned,e.event&&u(e.event.type||"info",e.event.message),e.threat&&y.value.push(e.threat),e.complete&&($.value=!1,I.value={scanType:S.value,timestamp:new Date().toISOString(),duration:oe(e.duration),itemsScanned:E.value,threatsDetected:y.value.length,threats:y.value},ie(I.value))}async function ie(e){try{const l=await b.post("/api/antivirus/scan/history",e);H.value.unshift(l.data),u("info",r("antivirus.scan_results_saved"))}catch{u("error",r("antivirus.scan_results_save_error"))}}async function re(){try{const e=await b.get("/api/antivirus/scan/history");H.value=e.data}catch{u("error",r("antivirus.history_load_error"))}}async function Se(){try{const e=await b.get("/api/antivirus/settings");f.value=e.data}catch{u("warning",r("antivirus.using_default_settings"))}}async function Ve(){try{const e=await b.put("/api/antivirus/settings",f.value);f.value=e.data,u("info",r("antivirus.settings_saved")),V.value&&(V.value.close(),G())}catch{u("error",r("antivirus.settings_save_error"))}}const V=p(null);function G(){f.value.realtimeProtection&&(V.value=new EventSource(`${ne.defaults.baseURL}/api/antivirus/realtime`),V.value.onmessage=e=>{const l=JSON.parse(e.data);u(l.type||"info",l.message),l.threat&&y.value.unshift(l.threat)},V.value.onerror=e=>{u("error",r("antivirus.realtime_disconnected")),setTimeout(()=>G(),5e3)},u("info",r("antivirus.realtime_activated")))}async function ue(){j.value=!0,u("info",r("antivirus.checking_updates"));try{const e=await b.post("/api/antivirus/update");M.value=e.data.version,z.value=new Date(e.data.updatedAt).toLocaleString(),u("info",r("antivirus.virus_db_updated"))}catch{u("error",r("antivirus.virus_db_update_error"))}finally{j.value=!1}}async function De(e){try{await b.post(`/api/antivirus/threats/${e.id}/quarantine`),u("info",r("antivirus.threat_quarantined")),Q()}catch{u("error",r("antivirus.quarantine_error"))}}async function Te(e){try{await b.delete(`/api/antivirus/threats/${e.id}`),u("info",r("antivirus.threat_removed")),Q()}catch{u("error",r("antivirus.remove_error"))}}async function Ce(){K.value=!0;try{await b.post("/api/antivirus/install"),u("info",r("antivirus.install_started")),await se()}catch{u("error",r("antivirus.install_error"))}finally{K.value=!1}}function oe(e){const l=Math.floor(e/60),n=Math.floor(e%60);return`${l}:${n<10?"0":""}${n}`}function de(e){return new Date(e).toLocaleString()}function Ue(e){Ge.info(r("antivirus.scan_details",{type:r(`antivirus.scan_types.${e.scanType}`),date:de(e.timestamp)}))}async function Q(){await re(),u("info",r("antivirus.history_refreshed"))}return Me(()=>{se(),Se(),re(),$e(),G()}),He(()=>{_.value&&_.value.close(),V.value&&V.value.close()}),(e,l)=>{const n=c("el-icon"),d=c("el-tag"),g=c("el-button"),D=c("el-descriptions-item"),Ee=c("el-descriptions"),W=c("el-radio-button"),Le=c("el-radio-group"),Ne=c("el-input"),X=c("el-divider"),ce=c("el-space"),Pe=c("el-progress"),qe=c("el-scrollbar"),Y=c("el-table-column"),Ie=c("el-table"),Z=c("el-tab-pane"),T=c("el-option"),ve=c("el-select"),me=c("el-card"),Oe=c("el-timeline-item"),Fe=c("el-timeline"),x=c("el-switch"),F=c("el-form-item"),Je=c("el-form"),Re=c("el-tabs");return h(),N(me,{class:"antivirus-status"},{header:a(()=>[w("div",Qe,[w("h2",null,[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:shield-check"})]),_:1}),o(" "+i(e.$t("antivirus.title")),1)])])]),default:a(()=>[t(Ee,{column:1,border:""},{default:a(()=>[t(D,{label:e.$t("antivirus.installed")},{default:a(()=>[t(d,{type:O.value.installed?"success":"danger"},{default:a(()=>[o(i(O.value.installed?e.$t("common.yes"):e.$t("common.no")),1)]),_:1},8,["type"]),O.value.installed?P("",!0):(h(),N(g,{key:0,type:"primary",link:"",onClick:Ce,loading:K.value},{default:a(()=>[o(" ("+i(e.$t("antivirus.install"))+") ",1)]),_:1},8,["loading"]))]),_:1},8,["label"]),t(D,{label:e.$t("antivirus.status")},{default:a(()=>[t(d,{type:ge(A.value)},{default:a(()=>[o(i(he.value),1)]),_:1},8,["type"])]),_:1},8,["label"]),t(D,{label:e.$t("antivirus.version")},{default:a(()=>[o(i(O.value.version||e.$t("antivirus.unknown")),1)]),_:1},8,["label"]),t(D,{label:e.$t("antivirus.virus_db")},{default:a(()=>[o(i(M.value||e.$t("antivirus.not_loaded"))+" ",1),t(g,{type:"primary",link:"",onClick:ue,loading:j.value},{default:a(()=>[o(" ("+i(e.$t("antivirus.check_updates"))+") ",1)]),_:1},8,["loading"])]),_:1},8,["label"]),t(D,{label:e.$t("antivirus.last_update")},{default:a(()=>[o(i(z.value||e.$t("antivirus.never")),1)]),_:1},8,["label"])]),_:1}),t(Re,{modelValue:ae.value,"onUpdate:modelValue":l[7]||(l[7]=s=>ae.value=s),class:"antivirus-tabs"},{default:a(()=>[t(Z,{label:e.$t("antivirus.scanner"),name:"scanner"},{default:a(()=>[w("div",We,[t(Le,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=s=>S.value=s)},{default:a(()=>[t(W,{value:"quick"},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:flash"})]),_:1}),o(" "+i(e.$t("antivirus.quick_scan")),1)]),_:1}),t(W,{value:"full"},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:harddisk"})]),_:1}),o(" "+i(e.$t("antivirus.full_scan")),1)]),_:1}),t(W,{value:"custom"},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:folder-multiple"})]),_:1}),o(" "+i(e.$t("antivirus.custom_scan")),1)]),_:1})]),_:1},8,["modelValue"]),S.value==="custom"?(h(),C("div",Xe,[t(Ne,{modelValue:J.value,"onUpdate:modelValue":l[1]||(l[1]=s=>J.value=s),placeholder:e.$t("antivirus.enter_path"),onKeyup:Ke(le,["enter"])},{append:a(()=>[t(g,{onClick:le},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:plus"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),w("div",Ye,[(h(!0),C(ee,null,te(U.value,(s,k)=>(h(),N(d,{key:k,closable:"",onClose:ze=>be(k)},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:folder"})]),_:1}),o(" "+i(s),1)]),_:2},1032,["onClose"]))),128))])])):P("",!0),t(g,{type:"primary",onClick:we,disabled:$.value,loading:$.value,class:"scan-button"},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:shield-sync"})]),_:1}),o(" "+i($.value?e.$t("antivirus.scanning"):e.$t("antivirus.start_scan")),1)]),_:1},8,["disabled","loading"])]),$.value||I.value?(h(),C("div",Ze,[t(X,null,{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:file-document-outline"})]),_:1}),o(" "+i(e.$t("antivirus.scan_report")),1)]),_:1}),w("div",xe,[t(ce,null,{default:a(()=>[t(d,null,{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:clock-outline"})]),_:1}),o(" "+i(e.$t("antivirus.duration"))+": "+i(B.value),1)]),_:1}),t(d,null,{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:file-tree"})]),_:1}),o(" "+i(e.$t("antivirus.scanned"))+": "+i(E.value)+" "+i(e.$t("antivirus.items")),1)]),_:1})]),_:1})]),t(Pe,{percentage:R.value,"stroke-width":20,"text-inside":!0,status:"success",class:"progress-bar"},null,8,["percentage"]),t(X,null,{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:progress-upload"})]),_:1}),o(" "+i(e.$t("antivirus.realtime_events")),1)]),_:1}),w("div",et,[t(qe,{height:"200px",class:"event-stream"},{default:a(()=>[(h(!0),C(ee,null,te(q.value,(s,k)=>(h(),C("div",{key:k,class:je(["event-item",{"info-event":s.type==="info","warning-event":s.type==="warning","danger-event":s.type==="danger","success-event":s.type==="success"}])},[t(n,null,{default:a(()=>[t(v(m),{icon:fe[s.type]},null,8,["icon"])]),_:2},1024),w("span",tt,"["+i(s.time)+"]",1),o(" "+i(s.message),1)],2))),128))]),_:1})]),y.value.length>0?(h(),C("div",at,[t(X,null,{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:alert-octagon"})]),_:1}),o(" "+i(e.$t("antivirus.detected_threats",{count:y.value.length})),1)]),_:1}),t(Ie,{data:y.value,height:"250",border:""},{default:a(()=>[t(Y,{prop:"name",label:e.$t("antivirus.threat_name"),width:"180"},null,8,["label"]),t(Y,{prop:"path",label:e.$t("antivirus.path")},null,8,["label"]),t(Y,{label:e.$t("antivirus.actions"),width:"200"},{default:a(({row:s})=>[t(g,{type:"danger",size:"small",onClick:k=>Te(s)},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:delete"})]),_:1}),o(" "+i(e.$t("antivirus.remove")),1)]),_:2},1032,["onClick"]),t(g,{type:"warning",size:"small",onClick:k=>De(s)},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:content-cut"})]),_:1}),o(" "+i(e.$t("antivirus.quarantine")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])])):P("",!0)])):P("",!0)]),_:1},8,["label"]),t(Z,{label:e.$t("antivirus.history"),name:"history"},{default:a(()=>[w("div",nt,[t(ve,{modelValue:L.value,"onUpdate:modelValue":l[2]||(l[2]=s=>L.value=s),placeholder:e.$t("antivirus.filter_history")},{default:a(()=>[t(T,{label:e.$t("antivirus.all_scans"),value:"all"},null,8,["label"]),t(T,{label:e.$t("antivirus.last_week"),value:"week"},null,8,["label"]),t(T,{label:e.$t("antivirus.last_month"),value:"month"},null,8,["label"]),t(T,{label:e.$t("antivirus.only_threats"),value:"threats"},null,8,["label"])]),_:1},8,["modelValue","placeholder"]),t(g,{onClick:Q,type:"primary"},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:refresh"})]),_:1}),o(" "+i(e.$t("antivirus.refresh")),1)]),_:1})]),t(Fe,{class:"history-list"},{default:a(()=>[(h(!0),C(ee,null,te(ye.value,(s,k)=>(h(),N(Oe,{key:k,timestamp:de(s.timestamp),placement:"top"},{default:a(()=>[t(me,null,{default:a(()=>[w("div",lt,[t(d,{type:s.threatsDetected>0?"danger":"success"},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:s.threatsDetected>0?"mdi:alert-octagon":"mdi:check-circle"},null,8,["icon"])]),_:2},1024),o(" "+i(e.$t(`antivirus.scan_types.${s.scanType}`))+" "+i(e.$t("antivirus.scan")),1)]),_:2},1032,["type"]),t(ce,null,{default:a(()=>[t(d,null,{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:clock-outline"})]),_:1}),o(" "+i(s.duration),1)]),_:2},1024),t(d,null,{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:file-tree"})]),_:1}),o(" "+i(s.itemsScanned)+" "+i(e.$t("antivirus.items")),1)]),_:2},1024),s.threatsDetected>0?(h(),N(d,{key:0,type:"danger"},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:virus"})]),_:1}),o(" "+i(s.threatsDetected)+" "+i(e.$t("antivirus.threats")),1)]),_:2},1024)):P("",!0)]),_:2},1024)]),t(g,{onClick:ze=>Ue(s),type:"primary",size:"small",class:"mt-2"},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:information"})]),_:1}),o(" "+i(e.$t("antivirus.details")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1},8,["label"]),t(Z,{label:e.$t("antivirus.settings"),name:"settings"},{default:a(()=>[t(Je,{model:f.value,"label-width":"250px"},{default:a(()=>[t(F,{label:e.$t("antivirus.auto_updates")},{default:a(()=>[t(x,{modelValue:f.value.autoUpdate,"onUpdate:modelValue":l[3]||(l[3]=s=>f.value.autoUpdate=s)},null,8,["modelValue"])]),_:1},8,["label"]),f.value.autoUpdate?(h(),N(F,{key:0,label:e.$t("antivirus.update_frequency")},{default:a(()=>[t(ve,{modelValue:f.value.updateFrequency,"onUpdate:modelValue":l[4]||(l[4]=s=>f.value.updateFrequency=s)},{default:a(()=>[t(T,{label:e.$t("antivirus.daily"),value:"daily"},null,8,["label"]),t(T,{label:e.$t("antivirus.weekly"),value:"weekly"},null,8,["label"]),t(T,{label:e.$t("antivirus.monthly"),value:"monthly"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"])):P("",!0),t(F,{label:e.$t("antivirus.realtime_protection")},{default:a(()=>[t(x,{modelValue:f.value.realtimeProtection,"onUpdate:modelValue":l[5]||(l[5]=s=>f.value.realtimeProtection=s)},null,8,["modelValue"])]),_:1},8,["label"]),t(F,{label:e.$t("antivirus.threat_notifications")},{default:a(()=>[t(x,{modelValue:f.value.notifications,"onUpdate:modelValue":l[6]||(l[6]=s=>f.value.notifications=s)},null,8,["modelValue"])]),_:1},8,["label"]),t(F,null,{default:a(()=>[t(g,{type:"primary",onClick:Ve},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:content-save"})]),_:1}),o(" "+i(e.$t("antivirus.save_settings")),1)]),_:1}),t(g,{onClick:ue},{default:a(()=>[t(n,null,{default:a(()=>[t(v(m),{icon:"mdi:cloud-download"})]),_:1}),o(" "+i(e.$t("antivirus.check_updates")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1})}}},ot=Ae(st,[["__scopeId","data-v-9da15693"]]);export{ot as default};
